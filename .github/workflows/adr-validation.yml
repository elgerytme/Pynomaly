name: ADR Validation

on:
  pull_request:
    paths:
      - 'docs/developer-guides/architecture/adr/ADR-*.md'
      - 'docs/developer-guides/architecture/adr/README.md'
      - 'docs/developer-guides/architecture/adr/template.md'
  push:
    branches: [main, master]
    paths:
      - 'docs/developer-guides/architecture/adr/ADR-*.md'
      - 'docs/developer-guides/architecture/adr/README.md'
      - 'docs/developer-guides/architecture/adr/template.md'

jobs:
  validate-adr:
    runs-on: ubuntu-latest
    name: Validate ADR Files
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml
          
      - name: Validate ADR Files
        run: |
          python .github/scripts/validate_adr.py
        shell: bash
        
      - name: Comment on PR (if validation fails)
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ‚ùå ADR Validation Failed
              
              The ADR validation check failed. Please ensure:
              
              1. **Filename Pattern**: ADR files must follow the pattern \`ADR-###-slug.md\`
              2. **Template Sections**: All required template sections must be present and not empty
              3. **Status Values**: Status must be one of: PROPOSED, ACCEPTED, REJECTED, SUPERSEDED, DEPRECATED
              4. **Sequential Numbering**: ADR numbers must be sequential and not skip numbers
              
              Please check the workflow logs for specific validation errors and fix them before requesting review.
              
              üìñ **Resources:**
              - [ADR Template](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/developer-guides/architecture/adr/template.md)
              - [ADR Guidelines](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/developer-guides/architecture/adr/README.md)
              - [Contributing Guidelines](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/developer-guides/contributing/CONTRIBUTING.md#architectural-decision-records-adrs)
              `
            })
