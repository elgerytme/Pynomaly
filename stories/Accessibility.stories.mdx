import { Meta } from '@storybook/blocks';

<Meta title="Guidelines/Accessibility" />

# Accessibility Guidelines

Pynomaly Design System follows **WCAG 2.1 AA** standards to ensure our anomaly detection interfaces are accessible to all users.

## üéØ Accessibility Standards

### **Level AA Compliance**
All components meet or exceed WCAG 2.1 AA requirements:
- **Color Contrast**: Minimum 4.5:1 for normal text, 3:1 for large text
- **Keyboard Navigation**: Full functionality without mouse
- **Screen Reader Support**: Comprehensive ARIA labeling
- **Focus Management**: Clear focus indicators and logical tab order

### **Testing Integration**
- **Automated Testing**: axe-core integration in all components
- **Manual Testing**: Screen reader validation and keyboard navigation
- **Continuous Monitoring**: Accessibility regression detection in CI/CD

## ‚å®Ô∏è Keyboard Navigation

### **Global Keyboard Shortcuts**
```
Tab / Shift+Tab    Navigate between interactive elements
Enter / Space      Activate buttons and controls
Escape            Close modals, dropdowns, or cancel actions
Arrow Keys        Navigate within component groups
Home / End        Navigate to first/last item in lists
```

### **Component-Specific Navigation**
- **Data Tables**: Arrow keys for cell navigation, Enter to sort
- **Charts**: Tab to focus, arrow keys to explore data points
- **Modal Dialogs**: Tab trapped within modal, Escape to close
- **Dropdown Menus**: Arrow keys for options, Enter to select

## üé® Color & Contrast

### **Contrast Ratios**
Our color system ensures accessibility across all variants:

```css
/* Text Contrast Ratios */
.text-gray-900 on .bg-white     /* 21:1 (AAA) */
.text-gray-800 on .bg-gray-50   /* 16.7:1 (AAA) */
.text-blue-600 on .bg-white     /* 7.3:1 (AAA) */
.text-red-600 on .bg-white      /* 5.9:1 (AA) */

/* Button Contrast Ratios */
.btn-primary                    /* 4.6:1 (AA) */
.btn-secondary                  /* 5.2:1 (AA) */
.btn-danger                     /* 4.8:1 (AA) */
```

### **Color-Blind Friendly**
- **Status Indicators**: Use icons + color + text patterns
- **Anomaly Detection**: Multiple visual cues beyond color
- **Charts**: Patterns, textures, and shapes alongside colors

## üì± Screen Reader Support

### **ARIA Implementation**
Every component includes comprehensive ARIA attributes:

```html
<!-- Status Indicator Example -->
<div class="status-indicator status-anomaly" 
     role="status" 
     aria-live="polite"
     aria-label="Anomaly detected with 95% confidence">
  <span class="status-icon" aria-hidden="true">‚ö†Ô∏è</span>
  <span class="status-text">Anomaly Detected</span>
  <span class="status-value">95%</span>
</div>

<!-- Data Table Example -->
<table role="table" aria-label="Anomaly detection results">
  <thead>
    <tr role="row">
      <th role="columnheader" aria-sort="none" tabindex="0">
        Dataset Name
      </th>
    </tr>
  </thead>
  <tbody>
    <tr role="row">
      <td role="gridcell">customer_data.csv</td>
    </tr>
  </tbody>
</table>
```

### **Live Regions**
Status updates and dynamic content use appropriate live regions:
- **polite**: Non-urgent updates (completion status)
- **assertive**: Critical alerts (anomaly detection)
- **off**: Static content that shouldn't interrupt

## üîç Focus Management

### **Focus Indicators**
Clear, consistent focus indicators across all components:

```css
.focus-visible {
  outline: 2px solid #0ea5e9;
  outline-offset: 2px;
  border-radius: 4px;
}

/* Component-specific focus styles */
.btn:focus-visible {
  outline: 2px solid #0ea5e9;
  outline-offset: 2px;
}

.form-input:focus {
  border-color: #0ea5e9;
  box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
}
```

### **Focus Trapping**
Modal dialogs and dropdown menus implement proper focus trapping:
- **Modal Open**: Focus moves to first interactive element
- **Tab Navigation**: Cycles within modal bounds
- **Modal Close**: Focus returns to trigger element

## üìä Data Accessibility

### **Chart Accessibility**
Data visualizations include multiple access methods:

```html
<!-- Chart with Data Table Alternative -->
<div class="chart-container">
  <div class="chart" role="img" aria-labelledby="chart-title" 
       aria-describedby="chart-desc">
    <!-- D3.js/ECharts visualization -->
  </div>
  
  <h3 id="chart-title">Anomaly Detection Timeline</h3>
  <p id="chart-desc">
    Time series showing 127 anomalies detected over 30 days
  </p>
  
  <!-- Data table alternative -->
  <details class="chart-data-table">
    <summary>View data table</summary>
    <table>
      <!-- Tabular representation of chart data -->
    </table>
  </details>
</div>
```

### **Anomaly Announcements**
Real-time anomaly detection includes screen reader announcements:

```javascript
// Announce new anomaly detection
const announceAnomaly = (anomaly) => {
  const announcement = document.createElement('div');
  announcement.setAttribute('aria-live', 'assertive');
  announcement.setAttribute('aria-atomic', 'true');
  announcement.textContent = `New anomaly detected in ${anomaly.dataset} 
                             with ${anomaly.confidence}% confidence`;
  document.body.appendChild(announcement);
  
  // Remove after announcement
  setTimeout(() => {
    document.body.removeChild(announcement);
  }, 1000);
};
```

## üß™ Testing Guidelines

### **Automated Testing**
Include accessibility tests in your development workflow:

```javascript
// Playwright accessibility testing
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test('anomaly dashboard is accessible', async ({ page }) => {
  await page.goto('/dashboard');
  
  const accessibilityScanResults = await new AxeBuilder({ page })
    .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
    .analyze();
    
  expect(accessibilityScanResults.violations).toEqual([]);
});
```

### **Manual Testing Checklist**
- [ ] **Keyboard Navigation**: All interactive elements accessible via keyboard
- [ ] **Screen Reader**: Content properly announced and navigable
- [ ] **Focus Management**: Clear focus indicators and logical tab order
- [ ] **Color Contrast**: All text meets minimum contrast requirements
- [ ] **Zoom Testing**: Interface usable at 200% zoom level
- [ ] **Motion Sensitivity**: Respect `prefers-reduced-motion` setting

### **Screen Reader Testing**
Test with multiple screen readers for comprehensive coverage:
- **NVDA** (Windows) - Free, widely used
- **JAWS** (Windows) - Industry standard
- **VoiceOver** (macOS/iOS) - Built-in Apple screen reader
- **TalkBack** (Android) - Built-in Android screen reader

## üéõÔ∏è Accessibility Features

### **Reduced Motion Support**
Respect user preferences for reduced motion:

```css
@media (prefers-reduced-motion: reduce) {
  .animate-spin {
    animation: none;
  }
  
  .transition-all {
    transition: none;
  }
  
  .chart-animation {
    animation-duration: 0.01ms !important;
  }
}
```

### **High Contrast Mode**
Support for Windows High Contrast Mode:

```css
@media (prefers-contrast: high) {
  .btn-primary {
    border: 2px solid;
    background: ButtonFace;
    color: ButtonText;
  }
  
  .status-indicator {
    border: 2px solid;
    background: transparent;
  }
}
```

### **Dark Mode Accessibility**
Dark theme maintains accessibility standards:

```css
.theme-dark {
  /* Ensure sufficient contrast in dark mode */
  --color-text: #f1f5f9;        /* 16.7:1 contrast */
  --color-text-muted: #cbd5e1;  /* 9.3:1 contrast */
  --color-bg: #0f172a;
  --color-border: #334155;
}
```

## üö® Common Pitfalls

### **Avoid These Mistakes**
- **Color-Only Information**: Never rely solely on color to convey meaning
- **Missing Labels**: All form controls must have associated labels
- **Poor Focus Order**: Tab order should follow logical reading sequence
- **Inaccessible Modals**: Modal dialogs must trap focus and handle Escape
- **Missing Alt Text**: Images and icons need descriptive alternative text

### **Best Practices**
- **Progressive Enhancement**: Build accessible foundation first
- **Semantic HTML**: Use appropriate HTML elements for their intended purpose
- **Consistent Patterns**: Maintain consistent interaction patterns
- **User Testing**: Include users with disabilities in testing process
- **Documentation**: Document accessibility features for developers

## üìö Resources

### **Guidelines & Standards**
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [WebAIM Resources](https://webaim.org/)

### **Testing Tools**
- [axe DevTools](https://www.deque.com/axe/devtools/)
- [WAVE Web Accessibility Evaluator](https://wave.webaim.org/)
- [Lighthouse Accessibility Audit](https://developers.google.com/web/tools/lighthouse/)

### **Screen Readers**
- [NVDA Download](https://www.nvaccess.org/download/)
- [VoiceOver Guide](https://support.apple.com/guide/voiceover/)
- [Testing with Screen Readers](https://webaim.org/articles/screenreader_testing/)

Remember: Accessibility is not a feature to add later‚Äîit's a fundamental requirement that should be considered from the beginning of every design and development decision.