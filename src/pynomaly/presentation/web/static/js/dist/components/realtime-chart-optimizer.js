(()=>{var S=(u,t)=>()=>(t||u((t={exports:{}}).exports,t),t.exports);var C=S((w,f)=>{var m=class{constructor(t=60){this.targetFPS=t,this.frameInterval=1e3/t,this.lastFrameTime=0,this.animationFrame=null,this.updateCallbacks=new Set,this.isRunning=!1,this.frameCount=0,this.actualFPS=0,this.frameTimeHistory=[],this.maxHistorySize=100}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.frameLoop())}stop(){this.isRunning=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}frameLoop(){if(!this.isRunning)return;let t=performance.now(),i=t-this.lastFrameTime;i>=this.frameInterval&&(this.frameCount++,this.frameTimeHistory.push(i),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),this.actualFPS=1e3/(this.frameTimeHistory.reduce((e,s)=>e+s,0)/this.frameTimeHistory.length),this.updateCallbacks.forEach(e=>{try{e(i,t)}catch(s){console.error("Frame update callback error:",s)}}),this.lastFrameTime=t-i%this.frameInterval),this.animationFrame=requestAnimationFrame(()=>this.frameLoop())}addUpdateCallback(t){return this.updateCallbacks.add(t),()=>this.updateCallbacks.delete(t)}getPerformanceMetrics(){return{targetFPS:this.targetFPS,actualFPS:Math.round(this.actualFPS),frameCount:this.frameCount,averageFrameTime:this.frameTimeHistory.reduce((t,i)=>t+i,0)/this.frameTimeHistory.length,isRunning:this.isRunning}}},l=class{constructor(t=1e4,i=.8){this.maxSize=t,this.compressionThreshold=i,this.buffer=[],this.writeIndex=0,this.readIndex=0,this.size=0,this.isCircular=!1,this.compressionRatio=.5,this.lastCompressionTime=0,this.totalWrites=0,this.totalReads=0,this.compressionCount=0}add(t){let i=performance.now(),e={data:t,timestamp:i,id:this.totalWrites++};return this.size<this.maxSize?(this.buffer[this.writeIndex]=e,this.size++):(this.buffer[this.writeIndex]=e,this.readIndex=(this.readIndex+1)%this.maxSize,this.isCircular=!0),this.writeIndex=(this.writeIndex+1)%this.maxSize,this.size/this.maxSize>this.compressionThreshold&&this.compress(),e.id}getLast(t=1){if(t<=0||this.size===0)return[];let i=[],e=Math.min(t,this.size);for(let s=0;s<e;s++){let a=this.isCircular?(this.writeIndex-1-s+this.maxSize)%this.maxSize:this.writeIndex-1-s;a>=0&&this.buffer[a]&&i.unshift(this.buffer[a])}return this.totalReads+=i.length,i}getRange(t,i){let e=[],s=this.getLast(this.size);for(let a of s)a.timestamp>=t&&a.timestamp<=i&&e.push(a);return e}compress(){if(performance.now()-this.lastCompressionTime<1e3)return;let t=Math.floor(this.maxSize*this.compressionRatio),i=this.getLast(this.size),e=Math.ceil(i.length/t),s=i.filter((a,r)=>r%e===0);this.buffer=new Array(this.maxSize),this.writeIndex=0,this.readIndex=0,this.size=0,this.isCircular=!1,s.forEach(a=>this.add(a.data)),this.compressionCount++,this.lastCompressionTime=performance.now()}clear(){this.buffer=[],this.writeIndex=0,this.readIndex=0,this.size=0,this.isCircular=!1}getStats(){return{size:this.size,maxSize:this.maxSize,utilization:(this.size/this.maxSize*100).toFixed(1)+"%",totalWrites:this.totalWrites,totalReads:this.totalReads,compressionCount:this.compressionCount,isCircular:this.isCircular}}},c=class{constructor(){this.animations=new Map,this.easingFunctions={linear:t=>t,easeInOut:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeOut:t=>1-Math.pow(1-t,3),easeIn:t=>t*t*t,elastic:t=>t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)}}animate(t,i,e,s,a="easeInOut",r,o){let n={id:t,fromValue:i,toValue:e,duration:s,easing:this.easingFunctions[a]||this.easingFunctions.easeInOut,onUpdate:r,onComplete:o,startTime:performance.now(),completed:!1};return this.animations.set(t,n),t}update(t){for(let[i,e]of this.animations){let s=t-e.startTime,a=Math.min(s/e.duration,1);if(a>=1){let r=e.toValue;e.onUpdate?.(r,1),e.onComplete?.(r),this.animations.delete(i)}else{let r=e.easing(a),o=e.fromValue+(e.toValue-e.fromValue)*r;e.onUpdate?.(o,a)}}}cancel(t){return this.animations.delete(t)}cancelAll(){this.animations.clear()}isAnimating(t){return this.animations.has(t)}},d=class{constructor(t={}){this.options={targetFPS:60,maxDataPoints:1e3,bufferSize:1e4,enableAnimations:!0,animationDuration:300,adaptiveQuality:!0,performanceThreshold:30,...t},this.frameController=new m(this.options.targetFPS),this.dataBuffer=new l(this.options.bufferSize),this.animationManager=new c,this.charts=new Map,this.chartUpdateQueue=new Set,this.performanceMonitor={frameDrops:0,averageFPS:0,memoryUsage:0,renderTime:0,lastQualityAdjustment:0},this.qualityLevel=1,this.qualitySettings={high:{pointSize:4,lineWidth:2,antiAliasing:!0,shadows:!0},medium:{pointSize:3,lineWidth:1.5,antiAliasing:!0,shadows:!1},low:{pointSize:2,lineWidth:1,antiAliasing:!1,shadows:!1}},this.init()}init(){this.frameController.addUpdateCallback((t,i)=>{this.update(t,i)}),setInterval(()=>{this.updatePerformanceMetrics()},1e3),this.start()}start(){this.frameController.start()}stop(){this.frameController.stop()}registerChart(t,i,e={}){let s={instance:i,lastUpdate:0,updateInterval:e.updateInterval||16,isDirty:!1,dataBuffer:new l(e.bufferSize||this.options.bufferSize),renderMode:e.renderMode||"canvas",priority:e.priority||1,...e};return this.charts.set(t,s),t}unregisterChart(t){let i=this.charts.get(t);i&&(i.dataBuffer.clear(),this.charts.delete(t),this.chartUpdateQueue.delete(t))}addDataPoint(t,i){let e=this.charts.get(t);if(!e)return;let s=e.dataBuffer.add(i);return e.isDirty=!0,this.chartUpdateQueue.add(t),s}addBatchData(t,i){let e=this.charts.get(t);if(!e)return;let s=i.map(a=>e.dataBuffer.add(a));return e.isDirty=!0,this.chartUpdateQueue.add(t),s}getChartData(t,i=null){let e=this.charts.get(t);return e?e.dataBuffer.getLast(i||this.options.maxDataPoints):[]}update(t,i){this.animationManager.update(i),this.updateCharts(i),this.options.adaptiveQuality&&this.adjustQuality()}updateCharts(t){let i=performance.now(),e=0,s=Array.from(this.chartUpdateQueue).map(a=>({id:a,chart:this.charts.get(a)})).filter(({chart:a})=>a).sort((a,r)=>r.chart.priority-a.chart.priority);for(let{id:a,chart:r}of s)if(t-r.lastUpdate>=r.updateInterval)try{this.renderChart(a,r,t),r.lastUpdate=t,r.isDirty=!1,e++}catch(o){console.error(`Error updating chart ${a}:`,o)}for(let{id:a,chart:r}of s)r.isDirty||this.chartUpdateQueue.delete(a);this.performanceMonitor.renderTime=performance.now()-i}renderChart(t,i,e){let{instance:s,dataBuffer:a,renderMode:r}=i,o=a.getLast(this.options.maxDataPoints),n=this.processDataForRendering(o),h=this.getCurrentQualitySettings();switch(r){case"canvas":this.renderCanvasChart(s,n,h);break;case"svg":this.renderSVGChart(s,n,h);break;case"webgl":this.renderWebGLChart(s,n,h);break;default:this.renderDefaultChart(s,n,h)}s.dispatchEvent?.(new CustomEvent("chart-updated",{detail:{chartId:t,dataPoints:n.length,timestamp:e}}))}processDataForRendering(t){return t.map(i=>({...i.data,timestamp:i.timestamp,id:i.id}))}renderCanvasChart(t,i,e){t.updateData&&t.updateData(i,{pointSize:e.pointSize,lineWidth:e.lineWidth,antiAliasing:e.antiAliasing,enableAnimations:this.options.enableAnimations&&e.antiAliasing})}renderSVGChart(t,i,e){t.updateData&&t.updateData(i,{strokeWidth:e.lineWidth,pointRadius:e.pointSize,enableTransitions:this.options.enableAnimations})}renderWebGLChart(t,i,e){t.updateData&&t.updateData(i,{pointSize:e.pointSize,lineWidth:e.lineWidth,enableShaders:e.antiAliasing})}renderDefaultChart(t,i,e){t.setData?t.setData(i):t.updateChart&&t.updateChart()}adjustQuality(){let t=performance.now();if(t-this.performanceMonitor.lastQualityAdjustment<2e3)return;let e=this.frameController.getPerformanceMetrics().actualFPS;e<this.options.performanceThreshold&&this.qualityLevel>.3?(this.qualityLevel=Math.max(.3,this.qualityLevel-.1),console.log(`Quality decreased to ${this.qualityLevel.toFixed(1)} (FPS: ${e})`)):e>this.options.performanceThreshold+10&&this.qualityLevel<1&&(this.qualityLevel=Math.min(1,this.qualityLevel+.05),console.log(`Quality increased to ${this.qualityLevel.toFixed(1)} (FPS: ${e})`)),this.performanceMonitor.lastQualityAdjustment=t}getCurrentQualitySettings(){return this.qualityLevel>=.8?this.qualitySettings.high:this.qualityLevel>=.5?this.qualitySettings.medium:this.qualitySettings.low}setQualityLevel(t){this.qualityLevel=Math.max(.1,Math.min(1,t))}animateChartTransition(t,i,e,s,a=null){let r=`${t}_${i}`,o=a||this.options.animationDuration;return this.animationManager.animate(r,e,s,o,"easeInOut",(n,h)=>{let p=this.charts.get(t);p&&p.instance.setProperty&&p.instance.setProperty(i,n)},n=>{let h=this.charts.get(t);h&&(h.isDirty=!0,this.chartUpdateQueue.add(t))})}updatePerformanceMetrics(){let t=this.frameController.getPerformanceMetrics();this.performanceMonitor.averageFPS=t.actualFPS,t.actualFPS<this.options.targetFPS*.8&&this.performanceMonitor.frameDrops++,performance.memory&&(this.performanceMonitor.memoryUsage=performance.memory.usedJSHeapSize/1024/1024)}getPerformanceReport(){let t=this.frameController.getPerformanceMetrics();return{fps:{target:t.targetFPS,actual:t.actualFPS,frameCount:t.frameCount},quality:{level:this.qualityLevel,settings:this.getCurrentQualitySettings()},charts:{registered:this.charts.size,updateQueue:this.chartUpdateQueue.size},performance:{...this.performanceMonitor,renderTime:this.performanceMonitor.renderTime.toFixed(2)+"ms"},buffers:Array.from(this.charts.entries()).map(([i,e])=>({chartId:i,...e.dataBuffer.getStats()}))}}destroy(){this.stop(),this.animationManager.cancelAll();for(let[t,i]of this.charts)i.dataBuffer.clear();this.charts.clear(),this.chartUpdateQueue.clear()}},g=new d;typeof f<"u"&&f.exports?f.exports={RealTimeChartOptimizer:d,FrameRateController:m,DataBufferManager:l,AnimationManager:c,globalChartOptimizer:g}:(window.RealTimeChartOptimizer=d,window.FrameRateController=m,window.DataBufferManager=l,window.AnimationManager=c,window.globalChartOptimizer=g)});C();})();
