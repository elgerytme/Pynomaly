(()=>{var Qn=class{constructor(e={}){this.options={url:e.url||this.getWebSocketUrl(),protocols:e.protocols||["anomaly-detection-v1"],maxReconnectAttempts:e.maxReconnectAttempts||10,reconnectInterval:e.reconnectInterval||3e3,maxReconnectDelay:e.maxReconnectDelay||3e4,heartbeatInterval:e.heartbeatInterval||3e4,messageQueueSize:e.messageQueueSize||1e3,enableMessageQueue:e.enableMessageQueue!==!1,enableCompression:e.enableCompression!==!1,enableLogging:e.enableLogging||!1,autoConnect:e.autoConnect!==!1,authentication:e.authentication||null,...e},this.ws=null,this.isConnected=!1,this.reconnectAttempts=0,this.listeners=new Map,this.subscriptions=new Set,this.heartbeatTimer=null,this.reconnectTimer=null,this.messageQueue=[],this.connectionId=null,this.bindMethods(),this.options.autoConnect&&this.connect()}bindMethods(){this.handleOpen=this.handleOpen.bind(this),this.handleMessage=this.handleMessage.bind(this),this.handleError=this.handleError.bind(this),this.handleClose=this.handleClose.bind(this),this.sendHeartbeat=this.sendHeartbeat.bind(this)}getWebSocketUrl(){let e=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host;return`${e}//${n}/ws/anomaly-detection`}connect(){return this.isConnected||this.ws&&this.ws.readyState===WebSocket.CONNECTING?Promise.resolve():new Promise((e,n)=>{try{this.log("Connecting to WebSocket...",this.options.url),this.ws=new WebSocket(this.options.url,this.options.protocols),this.options.enableCompression&&this.ws.extensions&&(this.ws.extensions="permessage-deflate");let r=setTimeout(()=>{this.ws.readyState===WebSocket.CONNECTING&&(this.ws.close(),n(new Error("Connection timeout")))},1e4);this.ws.addEventListener("open",i=>{clearTimeout(r),this.handleOpen(i),e()}),this.ws.addEventListener("message",this.handleMessage),this.ws.addEventListener("error",i=>{clearTimeout(r),this.handleError(i),n(i)}),this.ws.addEventListener("close",this.handleClose)}catch(r){this.log("Connection error:",r),n(r)}})}handleOpen(e){this.log("WebSocket connected"),this.isConnected=!0,this.reconnectAttempts=0,this.startHeartbeat(),this.processMessageQueue(),this.resubscribe(),this.emit("connected",{event:e,connectionId:this.connectionId})}handleMessage(e){try{let n=JSON.parse(e.data);if(this.log("Received message:",n),n.type==="system"){this.handleSystemMessage(n);return}if(n.type==="pong"){this.log("Heartbeat acknowledged");return}this.emit("message",n),n.type&&this.emit(n.type,n.data||n),n.subscription&&this.emit(`subscription:${n.subscription}`,n.data||n)}catch(n){this.log("Error parsing message:",n,e.data),this.emit("error",{type:"parse_error",error:n,rawData:e.data})}}handleSystemMessage(e){switch(e.action){case"connection_established":this.connectionId=e.connectionId,this.log("Connection ID received:",this.connectionId);break;case"subscription_confirmed":this.log("Subscription confirmed:",e.subscription),this.emit("subscription_confirmed",e);break;case"subscription_error":this.log("Subscription error:",e.error),this.emit("subscription_error",e);break;case"rate_limit_exceeded":this.log("Rate limit exceeded"),this.emit("rate_limit_exceeded",e);break;case"server_shutdown":this.log("Server shutdown notification"),this.emit("server_shutdown",e);break;default:this.log("Unknown system message:",e)}}handleError(e){this.log("WebSocket error:",e),this.emit("error",{type:"connection_error",error:e})}handleClose(e){this.log("WebSocket closed:",e.code,e.reason),this.isConnected=!1,this.stopHeartbeat(),this.emit("disconnected",{code:e.code,reason:e.reason,wasClean:e.wasClean}),!e.wasClean&&this.reconnectAttempts<this.options.maxReconnectAttempts&&this.scheduleReconnect()}scheduleReconnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectAttempts++;let e=Math.min(this.options.reconnectInterval*Math.pow(2,this.reconnectAttempts-1),3e4);this.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${e}ms`),this.reconnectTimer=setTimeout(()=>{this.log(`Reconnect attempt ${this.reconnectAttempts}`),this.connect().catch(n=>{this.log("Reconnect failed:",n),this.reconnectAttempts<this.options.maxReconnectAttempts?this.scheduleReconnect():this.emit("max_reconnect_attempts_reached")})},e)}startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(this.sendHeartbeat,this.options.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}sendHeartbeat(){this.isConnected&&this.send({type:"ping",timestamp:Date.now()})}send(e){if(!this.isConnected)return this.log("Queueing message (not connected):",e),this.messageQueue.push(e),!1;try{let n=typeof e=="string"?e:JSON.stringify(e);return this.ws.send(n),this.log("Sent message:",e),!0}catch(n){return this.log("Error sending message:",n),this.emit("error",{type:"send_error",error:n,data:e}),!1}}processMessageQueue(){for(;this.messageQueue.length>0;){let e=this.messageQueue.shift();this.send(e)}}subscribe(e,n={}){let r={type:"subscribe",subscription:e,params:n,timestamp:Date.now()};return this.subscriptions.add(e),this.send(r),this.log("Subscribed to:",e,n),()=>this.unsubscribe(e)}unsubscribe(e){this.subscriptions.delete(e),this.send({type:"unsubscribe",subscription:e,timestamp:Date.now()}),this.log("Unsubscribed from:",e)}resubscribe(){this.subscriptions.forEach(e=>{this.send({type:"subscribe",subscription:e,timestamp:Date.now()})})}on(e,n){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n),()=>this.off(e,n)}off(e,n){let r=this.listeners.get(e);r&&(r.delete(n),r.size===0&&this.listeners.delete(e))}emit(e,n){let r=this.listeners.get(e);r&&r.forEach(i=>{try{i(n)}catch(o){this.log("Error in event listener:",o)}})}isConnected(){return this.isConnected&&this.ws&&this.ws.readyState===WebSocket.OPEN}getConnectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}}getConnectionInfo(){return{connectionId:this.connectionId,state:this.getConnectionState(),reconnectAttempts:this.reconnectAttempts,subscriptions:Array.from(this.subscriptions),queuedMessages:this.messageQueue.length,url:this.options.url}}disconnect(){this.log("Disconnecting WebSocket"),this.stopHeartbeat(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&this.ws.close(1e3,"Client disconnect"),this.isConnected=!1,this.subscriptions.clear(),this.messageQueue=[]}log(...e){this.options.enableLogging&&console.log("[WebSocketService]",...e)}destroy(){this.disconnect(),this.listeners.clear(),this.resizeObserver&&this.resizeObserver.disconnect()}},tn=class{constructor(e={}){this.options={enableRealTimeDetection:!0,enableAlerts:!0,enableMetrics:!0,enableModelUpdates:!0,bufferSize:1e3,...e},this.wsService=new Qn(e),this.dataBuffer=[],this.alertsBuffer=[],this.callbacks=new Map,this.init()}init(){this.wsService.on("connected",()=>{this.setupSubscriptions()}),this.wsService.on("anomaly_detected",e=>{this.handleAnomalyDetected(e)}),this.wsService.on("real_time_data",e=>{this.handleRealTimeData(e)}),this.wsService.on("alert",e=>{this.handleAlert(e)}),this.wsService.on("model_update",e=>{this.handleModelUpdate(e)}),this.wsService.on("system_metrics",e=>{this.handleSystemMetrics(e)})}setupSubscriptions(){this.options.enableRealTimeDetection&&(this.wsService.subscribe("anomaly_detection"),this.wsService.subscribe("real_time_data")),this.options.enableAlerts&&this.wsService.subscribe("alerts"),this.options.enableMetrics&&this.wsService.subscribe("system_metrics"),this.options.enableModelUpdates&&this.wsService.subscribe("model_updates")}handleAnomalyDetected(e){let n={id:e.id||Date.now(),timestamp:e.timestamp||new Date().toISOString(),score:e.score,severity:e.severity||this.calculateSeverity(e.score),features:e.features||[],metadata:e.metadata||{},datasetId:e.datasetId,modelId:e.modelId};this.emit("anomaly_detected",n),(n.severity==="critical"||n.severity==="high")&&this.handleAlert({type:"anomaly",severity:n.severity,message:`${n.severity.toUpperCase()} anomaly detected with score ${n.score.toFixed(3)}`,anomaly:n})}handleRealTimeData(e){this.dataBuffer.push({...e,receivedAt:Date.now()}),this.dataBuffer.length>this.options.bufferSize&&this.dataBuffer.shift(),this.emit("real_time_data",e)}handleAlert(e){let n={id:e.id||Date.now(),timestamp:e.timestamp||new Date().toISOString(),type:e.type,severity:e.severity||"info",message:e.message,data:e.data||e.anomaly,acknowledged:!1,receivedAt:Date.now()};this.alertsBuffer.unshift(n),this.alertsBuffer.length>this.options.bufferSize&&this.alertsBuffer.pop(),this.emit("alert",n)}handleModelUpdate(e){this.emit("model_update",{modelId:e.modelId,version:e.version,performance:e.performance,status:e.status,timestamp:e.timestamp||new Date().toISOString()})}handleSystemMetrics(e){this.emit("system_metrics",{...e,receivedAt:Date.now()})}calculateSeverity(e){return e>=.9?"critical":e>=.7?"high":e>=.5?"medium":"low"}startRealTimeDetection(e,n={}){return this.wsService.send({type:"start_detection",datasetId:e,config:{algorithm:n.algorithm||"isolation_forest",threshold:n.threshold||.5,windowSize:n.windowSize||100,...n}})}stopRealTimeDetection(e){return this.wsService.send({type:"stop_detection",datasetId:e})}sendDataPoint(e){return this.wsService.send({type:"data_point",data:e,timestamp:Date.now()})}sendBatchData(e){return this.wsService.send({type:"batch_data",data:e,count:e.length,timestamp:Date.now()})}acknowledgeAlert(e){let n=this.alertsBuffer.find(r=>r.id===e);return n&&(n.acknowledged=!0,n.acknowledgedAt=Date.now()),this.wsService.send({type:"acknowledge_alert",alertId:e,timestamp:Date.now()})}requestModelRetraining(e,n={}){return this.wsService.send({type:"request_retraining",modelId:e,config:n,timestamp:Date.now()})}getRecentData(e=100){return this.dataBuffer.slice(-e)}getRecentAlerts(e=50){return this.alertsBuffer.slice(0,e)}getUnacknowledgedAlerts(){return this.alertsBuffer.filter(e=>!e.acknowledged)}on(e,n){return this.wsService.on(e,n)}off(e,n){return this.wsService.off(e,n)}emit(e,n){return this.wsService.emit(e,n)}connect(){return this.wsService.connect()}disconnect(){return this.wsService.disconnect()}isConnected(){return this.wsService.isConnected()}getConnectionInfo(){return{...this.wsService.getConnectionInfo(),buffers:{data:this.dataBuffer.length,alerts:this.alertsBuffer.length,unacknowledgedAlerts:this.getUnacknowledgedAlerts().length}}}destroy(){this.wsService.destroy(),this.dataBuffer=[],this.alertsBuffer=[],this.callbacks.clear()}};function Ut(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Zn(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Wt(t){let e,n,r;t.length!==2?(e=Ut,n=(a,l)=>Ut(t(a),l),r=(a,l)=>t(a)-l):(e=t===Ut||t===Zn?t:ca,n=t,r=t);function i(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let m=u+c>>>1;n(a[m],l)<0?u=m+1:c=m}while(u<c)}return u}function o(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let m=u+c>>>1;n(a[m],l)<=0?u=m+1:c=m}while(u<c)}return u}function s(a,l,u=0,c=a.length){let m=i(a,l,u,c-1);return m>u&&r(a[m-1],l)>-r(a[m],l)?m-1:m}return{left:i,center:s,right:o}}function ca(){return 0}function Kn(t){return t===null?NaN:+t}var ii=Wt(Ut),oi=ii.right,fa=ii.left,ha=Wt(Kn).center,Jn=oi;function be(t,e){let n,r;if(e===void 0)for(let i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)(o=e(o,++i,t))!=null&&(n===void 0?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}var re=class extends Map{constructor(e,n=pa){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(let[r,i]of e)this.set(r,i)}get(e){return super.get(si(this,e))}has(e){return super.has(si(this,e))}set(e,n){return super.set(ma(this,e),n)}delete(e){return super.delete(da(this,e))}};function si({_intern:t,_key:e},n){let r=e(n);return t.has(r)?t.get(r):n}function ma({_intern:t,_key:e},n){let r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function da({_intern:t,_key:e},n){let r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function pa(t){return t!==null&&typeof t=="object"?t.valueOf():t}var ga=Math.sqrt(50),xa=Math.sqrt(10),ya=Math.sqrt(2);function en(t,e,n){let r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),s=o>=ga?10:o>=xa?5:o>=ya?2:1,a,l,u;return i<0?(u=Math.pow(10,-i)/s,a=Math.round(t*u),l=Math.round(e*u),a/u<t&&++a,l/u>e&&--l,u=-u):(u=Math.pow(10,i)*s,a=Math.round(t/u),l=Math.round(e/u),a*u<t&&++a,l*u>e&&--l),l<a&&.5<=n&&n<2?en(t,e,n*2):[a,l,u]}function nn(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];let r=e<t,[i,o,s]=r?en(e,t,n):en(t,e,n);if(!(o>=i))return[];let a=o-i+1,l=new Array(a);if(r)if(s<0)for(let u=0;u<a;++u)l[u]=(o-u)/-s;else for(let u=0;u<a;++u)l[u]=(o-u)*s;else if(s<0)for(let u=0;u<a;++u)l[u]=(i+u)/-s;else for(let u=0;u<a;++u)l[u]=(i+u)*s;return l}function _e(t,e,n){return e=+e,t=+t,n=+n,en(t,e,n)[2]}function ie(t,e,n){e=+e,t=+t,n=+n;let r=e<t,i=r?_e(e,t,n):_e(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function ai(t){return t}var jn=1,tr=2,er=3,Se=4,li=1e-6;function va(t){return"translate("+t+",0)"}function wa(t){return"translate(0,"+t+")"}function ba(t){return e=>+t(e)}function _a(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Sa(){return!this.__axis}function ui(t,e){var n=[],r=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,u=t===jn||t===Se?-1:1,c=t===Se||t===tr?"x":"y",m=t===jn||t===er?va:wa;function f(d){var N=r??(e.ticks?e.ticks.apply(e,n):e.domain()),O=i??(e.tickFormat?e.tickFormat.apply(e,n):ai),x=Math.max(o,0)+a,g=e.range(),S=+g[0]+l,v=+g[g.length-1]+l,C=(e.bandwidth?_a:ba)(e.copy(),l),T=d.selection?d.selection():d,b=T.selectAll(".domain").data([null]),I=T.selectAll(".tick").data(N,e).order(),U=I.exit(),G=I.enter().append("g").attr("class","tick"),W=I.select("line"),D=I.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),I=I.merge(G),W=W.merge(G.append("line").attr("stroke","currentColor").attr(c+"2",u*o)),D=D.merge(G.append("text").attr("fill","currentColor").attr(c,u*x).attr("dy",t===jn?"0em":t===er?"0.71em":"0.32em")),d!==T&&(b=b.transition(d),I=I.transition(d),W=W.transition(d),D=D.transition(d),U=U.transition(d).attr("opacity",li).attr("transform",function(Y){return isFinite(Y=C(Y))?m(Y+l):this.getAttribute("transform")}),G.attr("opacity",li).attr("transform",function(Y){var P=this.parentNode.__axis;return m((P&&isFinite(P=P(Y))?P:C(Y))+l)})),U.remove(),b.attr("d",t===Se||t===tr?s?"M"+u*s+","+S+"H"+l+"V"+v+"H"+u*s:"M"+l+","+S+"V"+v:s?"M"+S+","+u*s+"V"+l+"H"+v+"V"+u*s:"M"+S+","+l+"H"+v),I.attr("opacity",1).attr("transform",function(Y){return m(C(Y)+l)}),W.attr(c+"2",u*o),D.attr(c,u*x).text(O),T.filter(Sa).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===tr?"start":t===Se?"end":"middle"),T.each(function(){this.__axis=C})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(r=d==null?null:Array.from(d),f):r&&r.slice()},f.tickFormat=function(d){return arguments.length?(i=d,f):i},f.tickSize=function(d){return arguments.length?(o=s=+d,f):o},f.tickSizeInner=function(d){return arguments.length?(o=+d,f):o},f.tickSizeOuter=function(d){return arguments.length?(s=+d,f):s},f.tickPadding=function(d){return arguments.length?(a=+d,f):a},f.offset=function(d){return arguments.length?(l=+d,f):l},f}function nr(t){return ui(er,t)}function rr(t){return ui(Se,t)}var Ma={value:()=>{}};function fi(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new rn(n)}function rn(t){this._=t}function Ta(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}rn.prototype=fi.prototype={constructor:rn,on:function(t,e){var n=this._,r=Ta(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=ka(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=ci(n[i],t.name,e);else if(e==null)for(i in n)n[i]=ci(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new rn(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function ka(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function ci(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Ma,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Ht=fi;var on="http://www.w3.org/1999/xhtml",ir={svg:"http://www.w3.org/2000/svg",xhtml:on,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Tt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),ir.hasOwnProperty(e)?{space:ir[e],local:t}:t}function Ca(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===on&&e.documentElement.namespaceURI===on?e.createElement(t):e.createElementNS(n,t)}}function Da(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function sn(t){var e=Tt(t);return(e.local?Da:Ca)(e)}function Aa(){}function Ft(t){return t==null?Aa:function(){return this.querySelector(t)}}function hi(t){typeof t!="function"&&(t=Ft(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),l,u,c=0;c<s;++c)(l=o[c])&&(u=t.call(l,l.__data__,c,o))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new K(r,this._parents)}function or(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ea(){return[]}function Me(t){return t==null?Ea:function(){return this.querySelectorAll(t)}}function Na(t){return function(){return or(t.apply(this,arguments))}}function mi(t){typeof t=="function"?t=Na(t):t=Me(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),i.push(l));return new K(r,i)}function Te(t){return function(){return this.matches(t)}}function an(t){return function(e){return e.matches(t)}}var Ra=Array.prototype.find;function za(t){return function(){return Ra.call(this.children,t)}}function Ia(){return this.firstElementChild}function di(t){return this.select(t==null?Ia:za(typeof t=="function"?t:an(t)))}var Oa=Array.prototype.filter;function La(){return Array.from(this.children)}function $a(t){return function(){return Oa.call(this.children,t)}}function pi(t){return this.selectAll(t==null?La:$a(typeof t=="function"?t:an(t)))}function gi(t){typeof t!="function"&&(t=Te(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new K(r,this._parents)}function ln(t){return new Array(t.length)}function xi(){return new K(this._enter||this._groups.map(ln),this._parents)}function ke(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ke.prototype={constructor:ke,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function yi(t){return function(){return t}}function Pa(t,e,n,r,i,o){for(var s=0,a,l=e.length,u=o.length;s<u;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new ke(t,o[s]);for(;s<l;++s)(a=e[s])&&(i[s]=a)}function Ua(t,e,n,r,i,o,s){var a,l,u=new Map,c=e.length,m=o.length,f=new Array(c),d;for(a=0;a<c;++a)(l=e[a])&&(f[a]=d=s.call(l,l.__data__,a,e)+"",u.has(d)?i[a]=l:u.set(d,l));for(a=0;a<m;++a)d=s.call(t,o[a],a,o)+"",(l=u.get(d))?(r[a]=l,l.__data__=o[a],u.delete(d)):n[a]=new ke(t,o[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(f[a])===l&&(i[a]=l)}function Wa(t){return t.__data__}function vi(t,e){if(!arguments.length)return Array.from(this,Wa);var n=e?Ua:Pa,r=this._parents,i=this._groups;typeof t!="function"&&(t=yi(t));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),u=0;u<o;++u){var c=r[u],m=i[u],f=m.length,d=Ha(t.call(c,c&&c.__data__,u,r)),N=d.length,O=a[u]=new Array(N),x=s[u]=new Array(N),g=l[u]=new Array(f);n(c,m,O,x,g,d,e);for(var S=0,v=0,C,T;S<N;++S)if(C=O[S]){for(S>=v&&(v=S+1);!(T=x[v])&&++v<N;);C._next=T||null}}return s=new K(s,r),s._enter=a,s._exit=l,s}function Ha(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function wi(){return new K(this._exit||this._groups.map(ln),this._parents)}function bi(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function _i(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var u=n[l],c=r[l],m=u.length,f=a[l]=new Array(m),d,N=0;N<m;++N)(d=u[N]||c[N])&&(f[N]=d);for(;l<i;++l)a[l]=n[l];return new K(a,this._parents)}function Si(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Mi(t){t||(t=Fa);function e(m,f){return m&&f?t(m.__data__,f.__data__):!m-!f}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,l=i[o]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new K(i,this._parents).order()}function Fa(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ti(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ki(){return Array.from(this)}function Ci(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function Di(){let t=0;for(let e of this)++t;return t}function Ai(){return!this.node()}function Ei(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function Ya(t){return function(){this.removeAttribute(t)}}function Ba(t){return function(){this.removeAttributeNS(t.space,t.local)}}function qa(t,e){return function(){this.setAttribute(t,e)}}function Xa(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ga(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Va(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ni(t,e){var n=Tt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Ba:Ya:typeof e=="function"?n.local?Va:Ga:n.local?Xa:qa)(n,e))}function un(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Qa(t){return function(){this.style.removeProperty(t)}}function Za(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ka(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ri(t,e,n){return arguments.length>1?this.each((e==null?Qa:typeof e=="function"?Ka:Za)(t,e,n??"")):zt(this.node(),t)}function zt(t,e){return t.style.getPropertyValue(e)||un(t).getComputedStyle(t,null).getPropertyValue(e)}function Ja(t){return function(){delete this[t]}}function ja(t,e){return function(){this[t]=e}}function tl(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function zi(t,e){return arguments.length>1?this.each((e==null?Ja:typeof e=="function"?tl:ja)(t,e)):this.node()[t]}function Ii(t){return t.trim().split(/^|\s+/)}function sr(t){return t.classList||new Oi(t)}function Oi(t){this._node=t,this._names=Ii(t.getAttribute("class")||"")}Oi.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Li(t,e){for(var n=sr(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function $i(t,e){for(var n=sr(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function el(t){return function(){Li(this,t)}}function nl(t){return function(){$i(this,t)}}function rl(t,e){return function(){(e.apply(this,arguments)?Li:$i)(this,t)}}function Pi(t,e){var n=Ii(t+"");if(arguments.length<2){for(var r=sr(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?rl:e?el:nl)(n,e))}function il(){this.textContent=""}function ol(t){return function(){this.textContent=t}}function sl(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ui(t){return arguments.length?this.each(t==null?il:(typeof t=="function"?sl:ol)(t)):this.node().textContent}function al(){this.innerHTML=""}function ll(t){return function(){this.innerHTML=t}}function ul(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Wi(t){return arguments.length?this.each(t==null?al:(typeof t=="function"?ul:ll)(t)):this.node().innerHTML}function cl(){this.nextSibling&&this.parentNode.appendChild(this)}function Hi(){return this.each(cl)}function fl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Fi(){return this.each(fl)}function Yi(t){var e=typeof t=="function"?t:sn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function hl(){return null}function Bi(t,e){var n=typeof t=="function"?t:sn(t),r=e==null?hl:typeof e=="function"?e:Ft(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ml(){var t=this.parentNode;t&&t.removeChild(this)}function qi(){return this.each(ml)}function dl(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pl(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Xi(t){return this.select(t?pl:dl)}function Gi(t){return arguments.length?this.property("__data__",t):this.node().__data__}function gl(t){return function(e){t.call(this,e,this.__data__)}}function xl(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function yl(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function vl(t,e,n){return function(){var r=this.__on,i,o=gl(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Vi(t,e,n){var r=xl(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(i=0,c=a[l];i<o;++i)if((s=r[i]).type===c.type&&s.name===c.name)return c.value}return}for(a=e?vl:yl,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function Qi(t,e,n){var r=un(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function wl(t,e){return function(){return Qi(this,t,e)}}function bl(t,e){return function(){return Qi(this,t,e.apply(this,arguments))}}function Zi(t,e){return this.each((typeof e=="function"?bl:wl)(t,e))}function*Ki(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var ar=[null];function K(t,e){this._groups=t,this._parents=e}function Ji(){return new K([[document.documentElement]],ar)}function _l(){return this}K.prototype=Ji.prototype={constructor:K,select:hi,selectAll:mi,selectChild:di,selectChildren:pi,filter:gi,data:vi,enter:xi,exit:wi,join:bi,merge:_i,selection:_l,order:Si,sort:Mi,call:Ti,nodes:ki,node:Ci,size:Di,empty:Ai,each:Ei,attr:Ni,style:Ri,property:zi,classed:Pi,text:Ui,html:Wi,raise:Hi,lower:Fi,append:Yi,insert:Bi,remove:qi,clone:Xi,datum:Gi,on:Vi,dispatch:Zi,[Symbol.iterator]:Ki};var kt=Ji;function J(t){return typeof t=="string"?new K([[document.querySelector(t)]],[document.documentElement]):new K([[t]],ar)}function ji(t){let e;for(;e=t.sourceEvent;)t=e;return t}function dt(t,e){if(t=ji(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}var cn={capture:!0,passive:!1};function fn(t){t.preventDefault(),t.stopImmediatePropagation()}function Ce(t){var e=t.document.documentElement,n=J(t).on("dragstart.drag",fn,cn);"onselectstart"in e?n.on("selectstart.drag",fn,cn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function De(t,e){var n=t.document.documentElement,r=J(t).on("dragstart.drag",null);e&&(r.on("click.drag",fn,cn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function hn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function lr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ne(){}var Ae=.7,pn=1/Ae,oe="\\s*([+-]?\\d+)\\s*",Ee="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",wt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sl=/^#([0-9a-f]{3,8})$/,Ml=new RegExp(`^rgb\\(${oe},${oe},${oe}\\)$`),Tl=new RegExp(`^rgb\\(${wt},${wt},${wt}\\)$`),kl=new RegExp(`^rgba\\(${oe},${oe},${oe},${Ee}\\)$`),Cl=new RegExp(`^rgba\\(${wt},${wt},${wt},${Ee}\\)$`),Dl=new RegExp(`^hsl\\(${Ee},${wt},${wt}\\)$`),Al=new RegExp(`^hsla\\(${Ee},${wt},${wt},${Ee}\\)$`),to={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};hn(Ne,gt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:eo,formatHex:eo,formatHex8:El,formatHsl:Nl,formatRgb:no,toString:no});function eo(){return this.rgb().formatHex()}function El(){return this.rgb().formatHex8()}function Nl(){return lo(this).formatHsl()}function no(){return this.rgb().formatRgb()}function gt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Sl.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?ro(e):n===3?new ht(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?mn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?mn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ml.exec(t))?new ht(e[1],e[2],e[3],1):(e=Tl.exec(t))?new ht(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=kl.exec(t))?mn(e[1],e[2],e[3],e[4]):(e=Cl.exec(t))?mn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Dl.exec(t))?so(e[1],e[2]/100,e[3]/100,1):(e=Al.exec(t))?so(e[1],e[2]/100,e[3]/100,e[4]):to.hasOwnProperty(t)?ro(to[t]):t==="transparent"?new ht(NaN,NaN,NaN,0):null}function ro(t){return new ht(t>>16&255,t>>8&255,t&255,1)}function mn(t,e,n,r){return r<=0&&(t=e=n=NaN),new ht(t,e,n,r)}function Rl(t){return t instanceof Ne||(t=gt(t)),t?(t=t.rgb(),new ht(t.r,t.g,t.b,t.opacity)):new ht}function se(t,e,n,r){return arguments.length===1?Rl(t):new ht(t,e,n,r??1)}function ht(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}hn(ht,se,lr(Ne,{brighter(t){return t=t==null?pn:Math.pow(pn,t),new ht(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Ae:Math.pow(Ae,t),new ht(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ht(Bt(this.r),Bt(this.g),Bt(this.b),gn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:io,formatHex:io,formatHex8:zl,formatRgb:oo,toString:oo}));function io(){return`#${Yt(this.r)}${Yt(this.g)}${Yt(this.b)}`}function zl(){return`#${Yt(this.r)}${Yt(this.g)}${Yt(this.b)}${Yt((isNaN(this.opacity)?1:this.opacity)*255)}`}function oo(){let t=gn(this.opacity);return`${t===1?"rgb(":"rgba("}${Bt(this.r)}, ${Bt(this.g)}, ${Bt(this.b)}${t===1?")":`, ${t})`}`}function gn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Bt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Yt(t){return t=Bt(t),(t<16?"0":"")+t.toString(16)}function so(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new pt(t,e,n,r)}function lo(t){if(t instanceof pt)return new pt(t.h,t.s,t.l,t.opacity);if(t instanceof Ne||(t=gt(t)),!t)return new pt;if(t instanceof pt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new pt(s,a,l,t.opacity)}function uo(t,e,n,r){return arguments.length===1?lo(t):new pt(t,e,n,r??1)}function pt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}hn(pt,uo,lr(Ne,{brighter(t){return t=t==null?pn:Math.pow(pn,t),new pt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ae:Math.pow(Ae,t),new pt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ht(ur(t>=240?t-240:t+120,i,r),ur(t,i,r),ur(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new pt(ao(this.h),dn(this.s),dn(this.l),gn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=gn(this.opacity);return`${t===1?"hsl(":"hsla("}${ao(this.h)}, ${dn(this.s)*100}%, ${dn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function ao(t){return t=(t||0)%360,t<0?t+360:t}function dn(t){return Math.max(0,Math.min(1,t||0))}function ur(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function cr(t,e,n,r,i){var o=t*t,s=o*t;return((1-3*t+3*o-s)*e+(4-6*o+3*s)*n+(1+3*t+3*o-3*s)*r+s*i)/6}function co(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],s=r>0?t[r-1]:2*i-o,a=r<e-1?t[r+2]:2*o-i;return cr((n-r/e)*e,s,i,o,a)}}function fo(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],s=t[(r+1)%e],a=t[(r+2)%e];return cr((n-r/e)*e,i,o,s,a)}}var Re=t=>()=>t;function Il(t,e){return function(n){return t+n*e}}function Ol(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function ho(t){return(t=+t)==1?xn:function(e,n){return n-e?Ol(e,n,t):Re(isNaN(e)?n:e)}}function xn(t,e){var n=e-t;return n?Il(t,n):Re(isNaN(t)?e:t)}var qt=function t(e){var n=ho(e);function r(i,o){var s=n((i=se(i)).r,(o=se(o)).r),a=n(i.g,o.g),l=n(i.b,o.b),u=xn(i.opacity,o.opacity);return function(c){return i.r=s(c),i.g=a(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=t,r}(1);function mo(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),o=new Array(n),s,a;for(s=0;s<n;++s)a=se(e[s]),r[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return r=t(r),i=t(i),o=t(o),a.opacity=1,function(l){return a.r=r(l),a.g=i(l),a.b=o(l),a+""}}}var Ll=mo(co),$l=mo(fo);function po(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=t[i]*(1-o)+e[i]*o;return r}}function go(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function xo(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)i[s]=Ct(t[s],e[s]);for(;s<n;++s)o[s]=e[s];return function(a){for(s=0;s<r;++s)o[s]=i[s](a);return o}}function yo(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function rt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function vo(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Ct(t[i],e[i]):r[i]=e[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var hr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fr=new RegExp(hr.source,"g");function Pl(t){return function(){return t}}function Ul(t){return function(e){return t(e)+""}}function ze(t,e){var n=hr.lastIndex=fr.lastIndex=0,r,i,o,s=-1,a=[],l=[];for(t=t+"",e=e+"";(r=hr.exec(t))&&(i=fr.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:rt(r,i)})),n=fr.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Ul(l[0].x):Pl(e):(e=l.length,function(u){for(var c=0,m;c<e;++c)a[(m=l[c]).i]=m.x(u);return a.join("")})}function Ct(t,e){var n=typeof e,r;return e==null||n==="boolean"?Re(e):(n==="number"?rt:n==="string"?(r=gt(e))?(e=r,qt):ze:e instanceof gt?qt:e instanceof Date?yo:go(e)?po:Array.isArray(e)?xo:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?vo:rt)(t,e)}function mr(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var wo=180/Math.PI,yn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function dr(t,e,n,r,i,o){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*wo,skewX:Math.atan(l)*wo,scaleX:s,scaleY:a}}var vn;function bo(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?yn:dr(e.a,e.b,e.c,e.d,e.e,e.f)}function _o(t){return t==null?yn:(vn||(vn=document.createElementNS("http://www.w3.org/2000/svg","g")),vn.setAttribute("transform",t),(t=vn.transform.baseVal.consolidate())?(t=t.matrix,dr(t.a,t.b,t.c,t.d,t.e,t.f)):yn)}function So(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function o(u,c,m,f,d,N){if(u!==m||c!==f){var O=d.push("translate(",null,e,null,n);N.push({i:O-4,x:rt(u,m)},{i:O-2,x:rt(c,f)})}else(m||f)&&d.push("translate("+m+e+f+n)}function s(u,c,m,f){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),f.push({i:m.push(i(m)+"rotate(",null,r)-2,x:rt(u,c)})):c&&m.push(i(m)+"rotate("+c+r)}function a(u,c,m,f){u!==c?f.push({i:m.push(i(m)+"skewX(",null,r)-2,x:rt(u,c)}):c&&m.push(i(m)+"skewX("+c+r)}function l(u,c,m,f,d,N){if(u!==m||c!==f){var O=d.push(i(d)+"scale(",null,",",null,")");N.push({i:O-4,x:rt(u,m)},{i:O-2,x:rt(c,f)})}else(m!==1||f!==1)&&d.push(i(d)+"scale("+m+","+f+")")}return function(u,c){var m=[],f=[];return u=t(u),c=t(c),o(u.translateX,u.translateY,c.translateX,c.translateY,m,f),s(u.rotate,c.rotate,m,f),a(u.skewX,c.skewX,m,f),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,m,f),u=c=null,function(d){for(var N=-1,O=f.length,x;++N<O;)m[(x=f[N]).i]=x.x(d);return m.join("")}}}var pr=So(bo,"px, ","px)","deg)"),gr=So(_o,", ",")",")");var Wl=1e-12;function Mo(t){return((t=Math.exp(t))+1/t)/2}function Hl(t){return((t=Math.exp(t))-1/t)/2}function Fl(t){return((t=Math.exp(2*t))-1)/(t+1)}var xr=function t(e,n,r){function i(o,s){var a=o[0],l=o[1],u=o[2],c=s[0],m=s[1],f=s[2],d=c-a,N=m-l,O=d*d+N*N,x,g;if(O<Wl)g=Math.log(f/u)/e,x=function(I){return[a+I*d,l+I*N,u*Math.exp(e*I*g)]};else{var S=Math.sqrt(O),v=(f*f-u*u+r*O)/(2*u*n*S),C=(f*f-u*u-r*O)/(2*f*n*S),T=Math.log(Math.sqrt(v*v+1)-v),b=Math.log(Math.sqrt(C*C+1)-C);g=(b-T)/e,x=function(I){var U=I*g,G=Mo(T),W=u/(n*S)*(G*Fl(e*U+T)-Hl(T));return[a+W*d,l+W*N,u*G/Mo(e*U+T)]}}return x.duration=g*1e3*e/Math.SQRT2,x}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return t(s,a,l)},i}(Math.SQRT2,2,4);var ae=0,Oe=0,Ie=0,ko=1e3,wn,Le,bn=0,Xt=0,_n=0,$e=typeof performance=="object"&&performance.now?performance:Date,Co=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ue(){return Xt||(Co(Yl),Xt=$e.now()+_n)}function Yl(){Xt=0}function Pe(){this._call=this._time=this._next=null}Pe.prototype=Sn.prototype={constructor:Pe,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Ue():+n)+(e==null?0:+e),!this._next&&Le!==this&&(Le?Le._next=this:wn=this,Le=this),this._call=t,this._time=n,yr()},stop:function(){this._call&&(this._call=null,this._time=1/0,yr())}};function Sn(t,e,n){var r=new Pe;return r.restart(t,e,n),r}function Do(){Ue(),++ae;for(var t=wn,e;t;)(e=Xt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ae}function To(){Xt=(bn=$e.now())+_n,ae=Oe=0;try{Do()}finally{ae=0,ql(),Xt=0}}function Bl(){var t=$e.now(),e=t-bn;e>ko&&(_n-=e,bn=t)}function ql(){for(var t,e=wn,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:wn=n);Le=t,yr(r)}function yr(t){if(!ae){Oe&&(Oe=clearTimeout(Oe));var e=t-Xt;e>24?(t<1/0&&(Oe=setTimeout(To,t-$e.now()-_n)),Ie&&(Ie=clearInterval(Ie))):(Ie||(bn=$e.now(),Ie=setInterval(Bl,ko)),ae=1,Co(To))}}function Mn(t,e,n){var r=new Pe;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Xl=Ht("start","end","cancel","interrupt"),Gl=[],No=0,Ao=1,kn=2,Tn=3,Eo=4,Cn=5,We=6;function It(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Vl(t,n,{name:e,index:r,group:i,on:Xl,tween:Gl,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:No})}function He(t,e){var n=j(t,e);if(n.state>No)throw new Error("too late; already scheduled");return n}function it(t,e){var n=j(t,e);if(n.state>Tn)throw new Error("too late; already running");return n}function j(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Vl(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Sn(o,0,n.time);function o(u){n.state=Ao,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var c,m,f,d;if(n.state!==Ao)return l();for(c in r)if(d=r[c],d.name===n.name){if(d.state===Tn)return Mn(s);d.state===Eo?(d.state=We,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<e&&(d.state=We,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(Mn(function(){n.state===Tn&&(n.state=Eo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=kn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===kn){for(n.state=Tn,i=new Array(f=n.tween.length),c=0,m=-1;c<f;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++m]=d);i.length=m+1}}function a(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=Cn,1),m=-1,f=i.length;++m<f;)i[m].call(t,c);n.state===Cn&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=We,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function bt(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>kn&&r.state<Cn,r.state=We,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function Ro(t){return this.each(function(){bt(this,t)})}function Ql(t,e){var n,r;return function(){var i=it(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function Zl(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=it(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}o.tween=i}}function zo(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=j(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?Ql:Zl)(n,t,e))}function le(t,e,n){var r=t._id;return t.each(function(){var i=it(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return j(i,r).value[e]}}function Dn(t,e){var n;return(typeof e=="number"?rt:e instanceof gt?qt:(n=gt(e))?(e=n,qt):ze)(t,e)}function Kl(t){return function(){this.removeAttribute(t)}}function Jl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jl(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function tu(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function eu(t,e,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a)))}}function nu(t,e,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a)))}}function Io(t,e){var n=Tt(t),r=n==="transform"?gr:Dn;return this.attrTween(t,typeof e=="function"?(n.local?nu:eu)(n,r,le(this,"attr."+t,e)):e==null?(n.local?Jl:Kl)(n):(n.local?tu:jl)(n,r,e))}function ru(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function iu(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ou(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&iu(t,o)),n}return i._value=e,i}function su(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&ru(t,o)),n}return i._value=e,i}function Oo(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Tt(t);return this.tween(n,(r.local?ou:su)(r,e))}function au(t,e){return function(){He(this,t).delay=+e.apply(this,arguments)}}function lu(t,e){return e=+e,function(){He(this,t).delay=e}}function Lo(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?au:lu)(e,t)):j(this.node(),e).delay}function uu(t,e){return function(){it(this,t).duration=+e.apply(this,arguments)}}function cu(t,e){return e=+e,function(){it(this,t).duration=e}}function $o(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?uu:cu)(e,t)):j(this.node(),e).duration}function fu(t,e){if(typeof e!="function")throw new Error;return function(){it(this,t).ease=e}}function Po(t){var e=this._id;return arguments.length?this.each(fu(e,t)):j(this.node(),e).ease}function hu(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;it(this,t).ease=n}}function Uo(t){if(typeof t!="function")throw new Error;return this.each(hu(this._id,t))}function Wo(t){typeof t!="function"&&(t=Te(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new ft(r,this._parents,this._name,this._id)}function Ho(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l=e[a],u=n[a],c=l.length,m=s[a]=new Array(c),f,d=0;d<c;++d)(f=l[d]||u[d])&&(m[d]=f);for(;a<r;++a)s[a]=e[a];return new ft(s,this._parents,this._name,this._id)}function mu(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function du(t,e,n){var r,i,o=mu(e)?He:it;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function Fo(t,e){var n=this._id;return arguments.length<2?j(this.node(),n).on.on(t):this.each(du(n,t,e))}function pu(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Yo(){return this.on("end.remove",pu(this._id))}function Bo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ft(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],l=a.length,u=o[s]=new Array(l),c,m,f=0;f<l;++f)(c=a[f])&&(m=t.call(c,c.__data__,f,a))&&("__data__"in c&&(m.__data__=c.__data__),u[f]=m,It(u[f],e,n,f,u,j(c,n)));return new ft(o,this._parents,e,n)}function qo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Me(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l=r[a],u=l.length,c,m=0;m<u;++m)if(c=l[m]){for(var f=t.call(c,c.__data__,m,l),d,N=j(c,n),O=0,x=f.length;O<x;++O)(d=f[O])&&It(d,e,n,O,f,N);o.push(f),s.push(c)}return new ft(o,s,e,n)}var gu=kt.prototype.constructor;function Xo(){return new gu(this._groups,this._parents)}function xu(t,e){var n,r,i;return function(){var o=zt(this,t),s=(this.style.removeProperty(t),zt(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function Go(t){return function(){this.style.removeProperty(t)}}function yu(t,e,n){var r,i=n+"",o;return function(){var s=zt(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function vu(t,e,n){var r,i,o;return function(){var s=zt(this,t),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),zt(this,t))),s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a))}}function wu(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var l=it(this,t),u=l.on,c=l.value[o]==null?a||(a=Go(e)):void 0;(u!==n||i!==c)&&(r=(n=u).copy()).on(s,i=c),l.on=r}}function Vo(t,e,n){var r=(t+="")=="transform"?pr:Dn;return e==null?this.styleTween(t,xu(t,r)).on("end.style."+t,Go(t)):typeof e=="function"?this.styleTween(t,vu(t,r,le(this,"style."+t,e))).each(wu(this._id,t)):this.styleTween(t,yu(t,r,e),n).on("end.style."+t,null)}function bu(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function _u(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&bu(t,s,n)),r}return o._value=e,o}function Qo(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,_u(t,e,n??""))}function Su(t){return function(){this.textContent=t}}function Mu(t){return function(){var e=t(this);this.textContent=e??""}}function Zo(t){return this.tween("text",typeof t=="function"?Mu(le(this,"text",t)):Su(t==null?"":t+""))}function Tu(t){return function(e){this.textContent=t.call(this,e)}}function ku(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Tu(i)),e}return r._value=t,r}function Ko(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,ku(t))}function Jo(){for(var t=this._name,e=this._id,n=An(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=j(l,e);It(l,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new ft(r,this._parents,t,n)}function jo(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};n.each(function(){var u=it(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),i===0&&o()})}var Cu=0;function ft(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function ts(t){return kt().transition(t)}function An(){return++Cu}var Dt=kt.prototype;ft.prototype=ts.prototype={constructor:ft,select:Bo,selectAll:qo,selectChild:Dt.selectChild,selectChildren:Dt.selectChildren,filter:Wo,merge:Ho,selection:Xo,transition:Jo,call:Dt.call,nodes:Dt.nodes,node:Dt.node,size:Dt.size,empty:Dt.empty,each:Dt.each,on:Fo,attr:Io,attrTween:Oo,style:Vo,styleTween:Qo,text:Zo,textTween:Ko,remove:Yo,tween:zo,delay:Lo,duration:$o,ease:Po,easeVarying:Uo,end:jo,[Symbol.iterator]:Dt[Symbol.iterator]};function En(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Du={time:null,delay:0,duration:250,ease:En};function Au(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function es(t){var e,n;t instanceof ft?(e=t._id,t=t._name):(e=An(),(n=Du).time=Ue(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&It(l,t,e,u,s,n||Au(l,e));return new ft(r,this._parents,t,e)}kt.prototype.interrupt=Ro;kt.prototype.transition=es;var Nn=t=>()=>t;function vr(t,{sourceEvent:e,target:n,selection:r,mode:i,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:i,enumerable:!0,configurable:!0},_:{value:o}})}function ns(t){t.stopImmediatePropagation()}function Rn(t){t.preventDefault(),t.stopImmediatePropagation()}var rs={name:"drag"},wr={name:"space"},ue={name:"handle"},ce={name:"center"},{abs:is,max:at,min:lt}=Math;function os(t){return[+t[0],+t[1]]}function Sr(t){return[os(t[0]),os(t[1])]}var zn={name:"x",handles:["w","e"].map(Fe),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},br={name:"y",handles:["n","s"].map(Fe),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},kg={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Fe),input:function(t){return t==null?null:Sr(t)},output:function(t){return t}},At={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},ss={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},as={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Eu={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Nu={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function Fe(t){return{type:t}}function Ru(t){return!t.ctrlKey&&!t.button}function zu(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Iu(){return navigator.maxTouchPoints||"ontouchstart"in this}function _r(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Ou(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Mr(){return Lu(zn)}function Lu(t){var e=zu,n=Ru,r=Iu,i=!0,o=Ht("start","brush","end"),s=6,a;function l(x){var g=x.property("__brush",O).selectAll(".overlay").data([Fe("overlay")]);g.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",At.overlay).merge(g).each(function(){var v=_r(this).extent;J(this).attr("x",v[0][0]).attr("y",v[0][1]).attr("width",v[1][0]-v[0][0]).attr("height",v[1][1]-v[0][1])}),x.selectAll(".selection").data([Fe("selection")]).enter().append("rect").attr("class","selection").attr("cursor",At.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var S=x.selectAll(".handle").data(t.handles,function(v){return v.type});S.exit().remove(),S.enter().append("rect").attr("class",function(v){return"handle handle--"+v.type}).attr("cursor",function(v){return At[v.type]}),x.each(u).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(r).on("touchstart.brush",f).on("touchmove.brush",d).on("touchend.brush touchcancel.brush",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}l.move=function(x,g,S){x.tween?x.on("start.brush",function(v){c(this,arguments).beforestart().start(v)}).on("interrupt.brush end.brush",function(v){c(this,arguments).end(v)}).tween("brush",function(){var v=this,C=v.__brush,T=c(v,arguments),b=C.selection,I=t.input(typeof g=="function"?g.apply(this,arguments):g,C.extent),U=Ct(b,I);function G(W){C.selection=W===1&&I===null?null:U(W),u.call(v),T.brush()}return b!==null&&I!==null?G:G(1)}):x.each(function(){var v=this,C=arguments,T=v.__brush,b=t.input(typeof g=="function"?g.apply(v,C):g,T.extent),I=c(v,C).beforestart();bt(v),T.selection=b===null?null:b,u.call(v),I.start(S).brush(S).end(S)})},l.clear=function(x,g){l.move(x,null,g)};function u(){var x=J(this),g=_r(this).selection;g?(x.selectAll(".selection").style("display",null).attr("x",g[0][0]).attr("y",g[0][1]).attr("width",g[1][0]-g[0][0]).attr("height",g[1][1]-g[0][1]),x.selectAll(".handle").style("display",null).attr("x",function(S){return S.type[S.type.length-1]==="e"?g[1][0]-s/2:g[0][0]-s/2}).attr("y",function(S){return S.type[0]==="s"?g[1][1]-s/2:g[0][1]-s/2}).attr("width",function(S){return S.type==="n"||S.type==="s"?g[1][0]-g[0][0]+s:s}).attr("height",function(S){return S.type==="e"||S.type==="w"?g[1][1]-g[0][1]+s:s})):x.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(x,g,S){var v=x.__brush.emitter;return v&&(!S||!v.clean)?v:new m(x,g,S)}function m(x,g,S){this.that=x,this.args=g,this.state=x.__brush,this.active=0,this.clean=S}m.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(x,g){return this.starting?(this.starting=!1,this.emit("start",x,g)):this.emit("brush",x),this},brush:function(x,g){return this.emit("brush",x,g),this},end:function(x,g){return--this.active===0&&(delete this.state.emitter,this.emit("end",x,g)),this},emit:function(x,g,S){var v=J(this.that).datum();o.call(x,this.that,new vr(x,{sourceEvent:g,target:l,selection:t.output(this.state.selection),mode:S,dispatch:o}),v)}};function f(x){if(a&&!x.touches||!n.apply(this,arguments))return;var g=this,S=x.target.__data__.type,v=(i&&x.metaKey?S="overlay":S)==="selection"?rs:i&&x.altKey?ce:ue,C=t===br?null:Eu[S],T=t===zn?null:Nu[S],b=_r(g),I=b.extent,U=b.selection,G=I[0][0],W,D,Y=I[0][1],P,h,_=I[1][0],p,w,A=I[1][1],k,E,z=0,L=0,ot,V=C&&T&&i&&x.shiftKey,tt,st,q=Array.from(x.touches||[x],R=>{let Z=R.identifier;return R=dt(R,g),R.point0=R.slice(),R.identifier=Z,R});bt(g);var nt=c(g,arguments,!0).beforestart();if(S==="overlay"){U&&(ot=!0);let R=[q[0],q[1]||q[0]];b.selection=U=[[W=t===br?G:lt(R[0][0],R[1][0]),P=t===zn?Y:lt(R[0][1],R[1][1])],[p=t===br?_:at(R[0][0],R[1][0]),k=t===zn?A:at(R[0][1],R[1][1])]],q.length>1&&Q(x)}else W=U[0][0],P=U[0][1],p=U[1][0],k=U[1][1];D=W,h=P,w=p,E=k;var M=J(g).attr("pointer-events","none"),$=M.selectAll(".overlay").attr("cursor",At[S]);if(x.touches)nt.moved=y,nt.ended=B;else{var H=J(x.view).on("mousemove.brush",y,!0).on("mouseup.brush",B,!0);i&&H.on("keydown.brush",ut,!0).on("keyup.brush",ct,!0),Ce(x.view)}u.call(g),nt.start(x,v.name);function y(R){for(let Z of R.changedTouches||[R])for(let we of q)we.identifier===Z.identifier&&(we.cur=dt(Z,g));if(V&&!tt&&!st&&q.length===1){let Z=q[0];is(Z.cur[0]-Z[0])>is(Z.cur[1]-Z[1])?st=!0:tt=!0}for(let Z of q)Z.cur&&(Z[0]=Z.cur[0],Z[1]=Z.cur[1]);ot=!0,Rn(R),Q(R)}function Q(R){let Z=q[0],we=Z.point0;var Rt;switch(z=Z[0]-we[0],L=Z[1]-we[1],v){case wr:case rs:{C&&(z=at(G-W,lt(_-p,z)),D=W+z,w=p+z),T&&(L=at(Y-P,lt(A-k,L)),h=P+L,E=k+L);break}case ue:{q[1]?(C&&(D=at(G,lt(_,q[0][0])),w=at(G,lt(_,q[1][0])),C=1),T&&(h=at(Y,lt(A,q[0][1])),E=at(Y,lt(A,q[1][1])),T=1)):(C<0?(z=at(G-W,lt(_-W,z)),D=W+z,w=p):C>0&&(z=at(G-p,lt(_-p,z)),D=W,w=p+z),T<0?(L=at(Y-P,lt(A-P,L)),h=P+L,E=k):T>0&&(L=at(Y-k,lt(A-k,L)),h=P,E=k+L));break}case ce:{C&&(D=at(G,lt(_,W-z*C)),w=at(G,lt(_,p+z*C))),T&&(h=at(Y,lt(A,P-L*T)),E=at(Y,lt(A,k+L*T)));break}}w<D&&(C*=-1,Rt=W,W=p,p=Rt,Rt=D,D=w,w=Rt,S in ss&&$.attr("cursor",At[S=ss[S]])),E<h&&(T*=-1,Rt=P,P=k,k=Rt,Rt=h,h=E,E=Rt,S in as&&$.attr("cursor",At[S=as[S]])),b.selection&&(U=b.selection),tt&&(D=U[0][0],w=U[1][0]),st&&(h=U[0][1],E=U[1][1]),(U[0][0]!==D||U[0][1]!==h||U[1][0]!==w||U[1][1]!==E)&&(b.selection=[[D,h],[w,E]],u.call(g),nt.brush(R,v.name))}function B(R){if(ns(R),R.touches){if(R.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else De(R.view,ot),H.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);M.attr("pointer-events","all"),$.attr("cursor",At.overlay),b.selection&&(U=b.selection),Ou(U)&&(b.selection=null,u.call(g)),nt.end(R,v.name)}function ut(R){switch(R.keyCode){case 16:{V=C&&T;break}case 18:{v===ue&&(C&&(p=w-z*C,W=D+z*C),T&&(k=E-L*T,P=h+L*T),v=ce,Q(R));break}case 32:{(v===ue||v===ce)&&(C<0?p=w-z:C>0&&(W=D-z),T<0?k=E-L:T>0&&(P=h-L),v=wr,$.attr("cursor",At.selection),Q(R));break}default:return}Rn(R)}function ct(R){switch(R.keyCode){case 16:{V&&(tt=st=V=!1,Q(R));break}case 18:{v===ce&&(C<0?p=w:C>0&&(W=D),T<0?k=E:T>0&&(P=h),v=ue,Q(R));break}case 32:{v===wr&&(R.altKey?(C&&(p=w-z*C,W=D+z*C),T&&(k=E-L*T,P=h+L*T),v=ce):(C<0?p=w:C>0&&(W=D),T<0?k=E:T>0&&(P=h),v=ue),$.attr("cursor",At[S]),Q(R));break}default:return}Rn(R)}}function d(x){c(this,arguments).moved(x)}function N(x){c(this,arguments).ended(x)}function O(){var x=this.__brush||{selection:null};return x.extent=Sr(e.apply(this,arguments)),x.dim=t,x}return l.extent=function(x){return arguments.length?(e=typeof x=="function"?x:Nn(Sr(x)),l):e},l.filter=function(x){return arguments.length?(n=typeof x=="function"?x:Nn(!!x),l):n},l.touchable=function(x){return arguments.length?(r=typeof x=="function"?x:Nn(!!x),l):r},l.handleSize=function(x){return arguments.length?(s=+x,l):s},l.keyModifiers=function(x){return arguments.length?(i=!!x,l):i},l.on=function(){var x=o.on.apply(o,arguments);return x===o?l:x},l}var Tr=Math.PI,kr=2*Tr,Gt=1e-6,$u=kr-Gt;function ls(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Pu(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return ls;let n=10**e;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}var Vt=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?ls:Pu(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,o,s){this._append`C${+e},${+n},${+r},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(e,n,r,i,o){if(e=+e,n=+n,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=r-e,u=i-n,c=s-e,m=a-n,f=c*c+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(f>Gt)if(!(Math.abs(m*l-u*c)>Gt)||!o)this._append`L${this._x1=e},${this._y1=n}`;else{let d=r-s,N=i-a,O=l*l+u*u,x=d*d+N*N,g=Math.sqrt(O),S=Math.sqrt(f),v=o*Math.tan((Tr-Math.acos((O+f-x)/(2*g*S)))/2),C=v/S,T=v/g;Math.abs(C-1)>Gt&&this._append`L${e+C*c},${n+C*m}`,this._append`A${o},${o},0,0,${+(m*d>c*N)},${this._x1=e+T*l},${this._y1=n+T*u}`}}arc(e,n,r,i,o,s){if(e=+e,n=+n,r=+r,s=!!s,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),l=r*Math.sin(i),u=e+a,c=n+l,m=1^s,f=s?i-o:o-i;this._x1===null?this._append`M${u},${c}`:(Math.abs(this._x1-u)>Gt||Math.abs(this._y1-c)>Gt)&&this._append`L${u},${c}`,r&&(f<0&&(f=f%kr+kr),f>$u?this._append`A${r},${r},0,1,${m},${e-a},${n-l}A${r},${r},0,1,${m},${this._x1=u},${this._y1=c}`:f>Gt&&this._append`A${r},${r},0,${+(f>=Tr)},${m},${this._x1=e+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function us(){return new Vt}us.prototype=Vt.prototype;function cs(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Qt(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _t(t){return t=Qt(Math.abs(t)),t?t[1]:NaN}function fs(t,e){return function(n,r){for(var i=n.length,o=[],s=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[s=(s+1)%t.length];return o.reverse().join(e)}}function hs(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Uu=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ot(t){if(!(e=Uu.exec(t)))throw new Error("invalid format: "+t);var e;return new In({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ot.prototype=In.prototype;function In(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}In.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ms(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Cr;function ds(t,e){var n=Qt(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Cr=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Qt(t,Math.max(0,e+o-1))[0]}function Dr(t,e){var n=Qt(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var Ar={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:cs,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Dr(t*100,e),r:Dr,s:ds,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Er(t){return t}var ps=Array.prototype.map,gs=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function xs(t){var e=t.grouping===void 0||t.thousands===void 0?Er:fs(ps.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Er:hs(ps.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"\u2212":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(m){m=Ot(m);var f=m.fill,d=m.align,N=m.sign,O=m.symbol,x=m.zero,g=m.width,S=m.comma,v=m.precision,C=m.trim,T=m.type;T==="n"?(S=!0,T="g"):Ar[T]||(v===void 0&&(v=12),C=!0,T="g"),(x||f==="0"&&d==="=")&&(x=!0,f="0",d="=");var b=O==="$"?n:O==="#"&&/[boxX]/.test(T)?"0"+T.toLowerCase():"",I=O==="$"?r:/[%p]/.test(T)?s:"",U=Ar[T],G=/[defgprs%]/.test(T);v=v===void 0?6:/[gprs]/.test(T)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function W(D){var Y=b,P=I,h,_,p;if(T==="c")P=U(D)+P,D="";else{D=+D;var w=D<0||1/D<0;if(D=isNaN(D)?l:U(Math.abs(D),v),C&&(D=ms(D)),w&&+D==0&&N!=="+"&&(w=!1),Y=(w?N==="("?N:a:N==="-"||N==="("?"":N)+Y,P=(T==="s"?gs[8+Cr/3]:"")+P+(w&&N==="("?")":""),G){for(h=-1,_=D.length;++h<_;)if(p=D.charCodeAt(h),48>p||p>57){P=(p===46?i+D.slice(h+1):D.slice(h))+P,D=D.slice(0,h);break}}}S&&!x&&(D=e(D,1/0));var A=Y.length+D.length+P.length,k=A<g?new Array(g-A+1).join(f):"";switch(S&&x&&(D=e(k+D,k.length?g-P.length:1/0),k=""),d){case"<":D=Y+D+P+k;break;case"=":D=Y+k+D+P;break;case"^":D=k.slice(0,A=k.length>>1)+Y+D+P+k.slice(A);break;default:D=k+Y+D+P;break}return o(D)}return W.toString=function(){return m+""},W}function c(m,f){var d=u((m=Ot(m),m.type="f",m)),N=Math.max(-8,Math.min(8,Math.floor(_t(f)/3)))*3,O=Math.pow(10,-N),x=gs[8+N/3];return function(g){return d(O*g)+x}}return{format:u,formatPrefix:c}}var On,fe,Ln;Nr({thousands:",",grouping:[3],currency:["$",""]});function Nr(t){return On=xs(t),fe=On.format,Ln=On.formatPrefix,On}function Rr(t){return Math.max(0,-_t(Math.abs(t)))}function zr(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_t(e)/3)))*3-_t(Math.abs(t)))}function Ir(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_t(e)-_t(t))+1}function Lt(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}var Or=Symbol("implicit");function Ye(){var t=new re,e=[],n=[],r=Or;function i(o){let s=t.get(o);if(s===void 0){if(r!==Or)return r;t.set(o,s=e.push(o)-1)}return n[s%n.length]}return i.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new re;for(let s of o)t.has(s)||t.set(s,e.push(s)-1);return i},i.range=function(o){return arguments.length?(n=Array.from(o),i):n.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Ye(e,n).unknown(r)},Lt.apply(i,arguments),i}function Lr(t){return function(){return t}}function $r(t){return+t}var ys=[0,1];function xt(t){return t}function Pr(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Lr(isNaN(e)?NaN:.5)}function Wu(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Hu(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1];return i<r?(r=Pr(i,r),o=n(s,o)):(r=Pr(r,i),o=n(o,s)),function(a){return o(r(a))}}function Fu(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)i[s]=Pr(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(a){var l=Jn(t,a,1,r)-1;return o[l](i[l](a))}}function he(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ur(){var t=ys,e=ys,n=Ct,r,i,o,s=xt,a,l,u;function c(){var f=Math.min(t.length,e.length);return s!==xt&&(s=Wu(t[0],t[f-1])),a=f>2?Fu:Hu,l=u=null,m}function m(f){return f==null||isNaN(f=+f)?o:(l||(l=a(t.map(r),e,n)))(r(s(f)))}return m.invert=function(f){return s(i((u||(u=a(e,t.map(r),rt)))(f)))},m.domain=function(f){return arguments.length?(t=Array.from(f,$r),c()):t.slice()},m.range=function(f){return arguments.length?(e=Array.from(f),c()):e.slice()},m.rangeRound=function(f){return e=Array.from(f),n=mr,c()},m.clamp=function(f){return arguments.length?(s=f?!0:xt,c()):s!==xt},m.interpolate=function(f){return arguments.length?(n=f,c()):n},m.unknown=function(f){return arguments.length?(o=f,m):o},function(f,d){return r=f,i=d,c()}}function Be(){return Ur()(xt,xt)}function Wr(t,e,n,r){var i=ie(t,e,n),o;switch(r=Ot(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=zr(i,s))&&(r.precision=o),Ln(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=Ir(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Rr(i))&&(r.precision=o-(r.type==="%")*2);break}}return fe(r)}function Hr(t){var e=t.domain;return t.ticks=function(n){var r=e();return nn(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return Wr(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,o=r.length-1,s=r[i],a=r[o],l,u,c=10;for(a<s&&(u=s,s=a,a=u,u=i,i=o,o=u);c-- >0;){if(u=_e(s,a,n),u===l)return r[i]=s,r[o]=a,e(r);if(u>0)s=Math.floor(s/u)*u,a=Math.ceil(a/u)*u;else if(u<0)s=Math.ceil(s*u)/u,a=Math.floor(a*u)/u;else break;l=u}return t},t}function qe(){var t=Be();return t.copy=function(){return he(t,qe())},Lt.apply(t,arguments),Hr(t)}function Fr(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],o=t[r],s;return o<i&&(s=n,n=r,r=s,s=i,i=o,o=s),t[n]=e.floor(i),t[r]=e.ceil(o),t}function vs(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Yu(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Bu(t){return t<0?-t*t:t*t}function qu(t){var e=t(xt,xt),n=1;function r(){return n===1?t(xt,xt):n===.5?t(Yu,Bu):t(vs(n),vs(1/n))}return e.exponent=function(i){return arguments.length?(n=+i,r()):n},Hr(e)}function $n(){var t=qu(Ur());return t.copy=function(){return he(t,$n()).exponent(t.exponent())},Lt.apply(t,arguments),t}function Yr(){return $n.apply(null,arguments).exponent(.5)}var Br=new Date,qr=new Date;function X(t,e,n,r){function i(o){return t(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(t(o=new Date(+o)),o),i.ceil=o=>(t(o=new Date(o-1)),e(o,1),t(o),o),i.round=o=>{let s=i(o),a=i.ceil(o);return o-s<a-o?s:a},i.offset=(o,s)=>(e(o=new Date(+o),s==null?1:Math.floor(s)),o),i.range=(o,s,a)=>{let l=[];if(o=i.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let u;do l.push(u=new Date(+o)),e(o,a),t(o);while(u<o&&o<s);return l},i.filter=o=>X(s=>{if(s>=s)for(;t(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;e(s,-1),!o(s););else for(;--a>=0;)for(;e(s,1),!o(s););}),n&&(i.count=(o,s)=>(Br.setTime(+o),qr.setTime(+s),t(Br),t(qr),Math.floor(n(Br,qr))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(r?s=>r(s)%o===0:s=>i.count(0,s)%o===0):i)),i}var Xe=X(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Xe.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?X(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Xe);var Vx=Xe.range;var St=X(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*1e3)},(t,e)=>(e-t)/1e3,t=>t.getUTCSeconds()),ws=St.range;var me=X(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*1e3)},(t,e)=>{t.setTime(+t+e*6e4)},(t,e)=>(e-t)/6e4,t=>t.getMinutes()),Xu=me.range,Pn=X(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*6e4)},(t,e)=>(e-t)/6e4,t=>t.getUTCMinutes()),Gu=Pn.range;var de=X(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*1e3-t.getMinutes()*6e4)},(t,e)=>{t.setTime(+t+e*36e5)},(t,e)=>(e-t)/36e5,t=>t.getHours()),Vu=de.range,Un=X(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*36e5)},(t,e)=>(e-t)/36e5,t=>t.getUTCHours()),Qu=Un.range;var Et=X(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/864e5,t=>t.getDate()-1),Zu=Et.range,Ve=X(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/864e5,t=>t.getUTCDate()-1),Ku=Ve.range,Wn=X(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/864e5,t=>Math.floor(t/864e5)),Ju=Wn.range;function Jt(t){return X(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/6048e5)}var Nt=Jt(0),pe=Jt(1),_s=Jt(2),Ss=Jt(3),$t=Jt(4),Ms=Jt(5),Ts=Jt(6),ks=Nt.range,ju=pe.range,tc=_s.range,ec=Ss.range,nc=$t.range,rc=Ms.range,ic=Ts.range;function jt(t){return X(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/6048e5)}var te=jt(0),ge=jt(1),Cs=jt(2),Ds=jt(3),Pt=jt(4),As=jt(5),Es=jt(6),Ns=te.range,oc=ge.range,sc=Cs.range,ac=Ds.range,lc=Pt.range,uc=As.range,cc=Es.range;var xe=X(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth()),fc=xe.range,Hn=X(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth()),hc=Hn.range;var mt=X(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());mt.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:X(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});var mc=mt.range,yt=X(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());yt.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:X(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});var dc=yt.range;function zs(t,e,n,r,i,o){let s=[[St,1,1e3],[St,5,5*1e3],[St,15,15*1e3],[St,30,30*1e3],[o,1,6e4],[o,5,5*6e4],[o,15,15*6e4],[o,30,30*6e4],[i,1,36e5],[i,3,3*36e5],[i,6,6*36e5],[i,12,12*36e5],[r,1,864e5],[r,2,2*864e5],[n,1,6048e5],[e,1,2592e6],[e,3,3*2592e6],[t,1,31536e6]];function a(u,c,m){let f=c<u;f&&([u,c]=[c,u]);let d=m&&typeof m.range=="function"?m:l(u,c,m),N=d?d.range(u,+c+1):[];return f?N.reverse():N}function l(u,c,m){let f=Math.abs(c-u)/m,d=Wt(([,,x])=>x).right(s,f);if(d===s.length)return t.every(ie(u/31536e6,c/31536e6,m));if(d===0)return Xe.every(Math.max(ie(u,c,m),1));let[N,O]=s[f/s[d-1][2]<s[d][2]/f?d-1:d];return N.every(O)}return[a,l]}var[gc,xc]=zs(yt,Hn,te,Wn,Un,Pn),[Xr,Gr]=zs(mt,xe,Nt,Et,de,me);function Vr(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Qr(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Qe(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Zr(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,s=t.shortDays,a=t.months,l=t.shortMonths,u=Ze(i),c=Ke(i),m=Ze(o),f=Ke(o),d=Ze(s),N=Ke(s),O=Ze(a),x=Ke(a),g=Ze(l),S=Ke(l),v={a:w,A,b:k,B:E,c:null,d:Us,e:Us,f:Wc,g:Zc,G:Jc,H:$c,I:Pc,j:Uc,L:Bs,m:Hc,M:Fc,p:z,q:L,Q:Fs,s:Ys,S:Yc,u:Bc,U:qc,V:Xc,w:Gc,W:Vc,x:null,X:null,y:Qc,Y:Kc,Z:jc,"%":Hs},C={a:ot,A:V,b:tt,B:st,c:null,d:Ws,e:Ws,f:rf,g:df,G:gf,H:tf,I:ef,j:nf,L:Xs,m:of,M:sf,p:q,q:nt,Q:Fs,s:Ys,S:af,u:lf,U:uf,V:cf,w:ff,W:hf,x:null,X:null,y:mf,Y:pf,Z:xf,"%":Hs},T={a:W,A:D,b:Y,B:P,c:h,d:$s,e:$s,f:zc,g:Ls,G:Os,H:Ps,I:Ps,j:Ac,L:Rc,m:Dc,M:Ec,p:G,q:Cc,Q:Oc,s:Lc,S:Nc,u:_c,U:Sc,V:Mc,w:bc,W:Tc,x:_,X:p,y:Ls,Y:Os,Z:kc,"%":Ic};v.x=b(n,v),v.X=b(r,v),v.c=b(e,v),C.x=b(n,C),C.X=b(r,C),C.c=b(e,C);function b(M,$){return function(H){var y=[],Q=-1,B=0,ut=M.length,ct,R,Z;for(H instanceof Date||(H=new Date(+H));++Q<ut;)M.charCodeAt(Q)===37&&(y.push(M.slice(B,Q)),(R=Is[ct=M.charAt(++Q)])!=null?ct=M.charAt(++Q):R=ct==="e"?" ":"0",(Z=$[ct])&&(ct=Z(H,R)),y.push(ct),B=Q+1);return y.push(M.slice(B,Q)),y.join("")}}function I(M,$){return function(H){var y=Qe(1900,void 0,1),Q=U(y,M,H+="",0),B,ut;if(Q!=H.length)return null;if("Q"in y)return new Date(y.Q);if("s"in y)return new Date(y.s*1e3+("L"in y?y.L:0));if($&&!("Z"in y)&&(y.Z=0),"p"in y&&(y.H=y.H%12+y.p*12),y.m===void 0&&(y.m="q"in y?y.q:0),"V"in y){if(y.V<1||y.V>53)return null;"w"in y||(y.w=1),"Z"in y?(B=Qr(Qe(y.y,0,1)),ut=B.getUTCDay(),B=ut>4||ut===0?ge.ceil(B):ge(B),B=Ve.offset(B,(y.V-1)*7),y.y=B.getUTCFullYear(),y.m=B.getUTCMonth(),y.d=B.getUTCDate()+(y.w+6)%7):(B=Vr(Qe(y.y,0,1)),ut=B.getDay(),B=ut>4||ut===0?pe.ceil(B):pe(B),B=Et.offset(B,(y.V-1)*7),y.y=B.getFullYear(),y.m=B.getMonth(),y.d=B.getDate()+(y.w+6)%7)}else("W"in y||"U"in y)&&("w"in y||(y.w="u"in y?y.u%7:"W"in y?1:0),ut="Z"in y?Qr(Qe(y.y,0,1)).getUTCDay():Vr(Qe(y.y,0,1)).getDay(),y.m=0,y.d="W"in y?(y.w+6)%7+y.W*7-(ut+5)%7:y.w+y.U*7-(ut+6)%7);return"Z"in y?(y.H+=y.Z/100|0,y.M+=y.Z%100,Qr(y)):Vr(y)}}function U(M,$,H,y){for(var Q=0,B=$.length,ut=H.length,ct,R;Q<B;){if(y>=ut)return-1;if(ct=$.charCodeAt(Q++),ct===37){if(ct=$.charAt(Q++),R=T[ct in Is?$.charAt(Q++):ct],!R||(y=R(M,H,y))<0)return-1}else if(ct!=H.charCodeAt(y++))return-1}return y}function G(M,$,H){var y=u.exec($.slice(H));return y?(M.p=c.get(y[0].toLowerCase()),H+y[0].length):-1}function W(M,$,H){var y=d.exec($.slice(H));return y?(M.w=N.get(y[0].toLowerCase()),H+y[0].length):-1}function D(M,$,H){var y=m.exec($.slice(H));return y?(M.w=f.get(y[0].toLowerCase()),H+y[0].length):-1}function Y(M,$,H){var y=g.exec($.slice(H));return y?(M.m=S.get(y[0].toLowerCase()),H+y[0].length):-1}function P(M,$,H){var y=O.exec($.slice(H));return y?(M.m=x.get(y[0].toLowerCase()),H+y[0].length):-1}function h(M,$,H){return U(M,e,$,H)}function _(M,$,H){return U(M,n,$,H)}function p(M,$,H){return U(M,r,$,H)}function w(M){return s[M.getDay()]}function A(M){return o[M.getDay()]}function k(M){return l[M.getMonth()]}function E(M){return a[M.getMonth()]}function z(M){return i[+(M.getHours()>=12)]}function L(M){return 1+~~(M.getMonth()/3)}function ot(M){return s[M.getUTCDay()]}function V(M){return o[M.getUTCDay()]}function tt(M){return l[M.getUTCMonth()]}function st(M){return a[M.getUTCMonth()]}function q(M){return i[+(M.getUTCHours()>=12)]}function nt(M){return 1+~~(M.getUTCMonth()/3)}return{format:function(M){var $=b(M+="",v);return $.toString=function(){return M},$},parse:function(M){var $=I(M+="",!1);return $.toString=function(){return M},$},utcFormat:function(M){var $=b(M+="",C);return $.toString=function(){return M},$},utcParse:function(M){var $=I(M+="",!0);return $.toString=function(){return M},$}}}var Is={"-":"",_:" ",0:"0"},et=/^\s*\d+/,yc=/^%/,vc=/[\\^$*+?|[\]().{}]/g;function F(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function wc(t){return t.replace(vc,"\\$&")}function Ze(t){return new RegExp("^(?:"+t.map(wc).join("|")+")","i")}function Ke(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function bc(t,e,n){var r=et.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function _c(t,e,n){var r=et.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Sc(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Mc(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Tc(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function Os(t,e,n){var r=et.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Ls(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function kc(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Cc(t,e,n){var r=et.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Dc(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function $s(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Ac(t,e,n){var r=et.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Ps(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Ec(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Nc(t,e,n){var r=et.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Rc(t,e,n){var r=et.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function zc(t,e,n){var r=et.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ic(t,e,n){var r=yc.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Oc(t,e,n){var r=et.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Lc(t,e,n){var r=et.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Us(t,e){return F(t.getDate(),e,2)}function $c(t,e){return F(t.getHours(),e,2)}function Pc(t,e){return F(t.getHours()%12||12,e,2)}function Uc(t,e){return F(1+Et.count(mt(t),t),e,3)}function Bs(t,e){return F(t.getMilliseconds(),e,3)}function Wc(t,e){return Bs(t,e)+"000"}function Hc(t,e){return F(t.getMonth()+1,e,2)}function Fc(t,e){return F(t.getMinutes(),e,2)}function Yc(t,e){return F(t.getSeconds(),e,2)}function Bc(t){var e=t.getDay();return e===0?7:e}function qc(t,e){return F(Nt.count(mt(t)-1,t),e,2)}function qs(t){var e=t.getDay();return e>=4||e===0?$t(t):$t.ceil(t)}function Xc(t,e){return t=qs(t),F($t.count(mt(t),t)+(mt(t).getDay()===4),e,2)}function Gc(t){return t.getDay()}function Vc(t,e){return F(pe.count(mt(t)-1,t),e,2)}function Qc(t,e){return F(t.getFullYear()%100,e,2)}function Zc(t,e){return t=qs(t),F(t.getFullYear()%100,e,2)}function Kc(t,e){return F(t.getFullYear()%1e4,e,4)}function Jc(t,e){var n=t.getDay();return t=n>=4||n===0?$t(t):$t.ceil(t),F(t.getFullYear()%1e4,e,4)}function jc(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+F(e/60|0,"0",2)+F(e%60,"0",2)}function Ws(t,e){return F(t.getUTCDate(),e,2)}function tf(t,e){return F(t.getUTCHours(),e,2)}function ef(t,e){return F(t.getUTCHours()%12||12,e,2)}function nf(t,e){return F(1+Ve.count(yt(t),t),e,3)}function Xs(t,e){return F(t.getUTCMilliseconds(),e,3)}function rf(t,e){return Xs(t,e)+"000"}function of(t,e){return F(t.getUTCMonth()+1,e,2)}function sf(t,e){return F(t.getUTCMinutes(),e,2)}function af(t,e){return F(t.getUTCSeconds(),e,2)}function lf(t){var e=t.getUTCDay();return e===0?7:e}function uf(t,e){return F(te.count(yt(t)-1,t),e,2)}function Gs(t){var e=t.getUTCDay();return e>=4||e===0?Pt(t):Pt.ceil(t)}function cf(t,e){return t=Gs(t),F(Pt.count(yt(t),t)+(yt(t).getUTCDay()===4),e,2)}function ff(t){return t.getUTCDay()}function hf(t,e){return F(ge.count(yt(t)-1,t),e,2)}function mf(t,e){return F(t.getUTCFullYear()%100,e,2)}function df(t,e){return t=Gs(t),F(t.getUTCFullYear()%100,e,2)}function pf(t,e){return F(t.getUTCFullYear()%1e4,e,4)}function gf(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Pt(t):Pt.ceil(t),F(t.getUTCFullYear()%1e4,e,4)}function xf(){return"+0000"}function Hs(){return"%"}function Fs(t){return+t}function Ys(t){return Math.floor(+t/1e3)}var ye,ee,Vs,Qs,Zs;Kr({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Kr(t){return ye=Zr(t),ee=ye.format,Vs=ye.parse,Qs=ye.utcFormat,Zs=ye.utcParse,ye}function yf(t){return new Date(t)}function vf(t){return t instanceof Date?+t:+new Date(+t)}function Ks(t,e,n,r,i,o,s,a,l,u){var c=Be(),m=c.invert,f=c.domain,d=u(".%L"),N=u(":%S"),O=u("%I:%M"),x=u("%I %p"),g=u("%a %d"),S=u("%b %d"),v=u("%B"),C=u("%Y");function T(b){return(l(b)<b?d:a(b)<b?N:s(b)<b?O:o(b)<b?x:r(b)<b?i(b)<b?g:S:n(b)<b?v:C)(b)}return c.invert=function(b){return new Date(m(b))},c.domain=function(b){return arguments.length?f(Array.from(b,vf)):f().map(yf)},c.ticks=function(b){var I=f();return t(I[0],I[I.length-1],b??10)},c.tickFormat=function(b,I){return I==null?T:u(I)},c.nice=function(b){var I=f();return(!b||typeof b.range!="function")&&(b=e(I[0],I[I.length-1],b??10)),b?f(Fr(I,b)):c},c.copy=function(){return he(c,Ks(t,e,n,r,i,o,s,a,l,u))},c}function Fn(){return Lt.apply(Ks(Xr,Gr,mt,xe,Nt,Et,de,me,St,ee).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Js(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}var Jr=Js("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ne(t){return function(){return t}}function js(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{let r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Vt(e)}var tv=Array.prototype.slice;function ta(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function ea(t){this._context=t}ea.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function na(t){return new ea(t)}function ra(t){return t[0]}function ia(t){return t[1]}function Yn(t,e){var n=ne(!0),r=null,i=na,o=null,s=js(a);t=typeof t=="function"?t:t===void 0?ra:ne(t),e=typeof e=="function"?e:e===void 0?ia:ne(e);function a(l){var u,c=(l=ta(l)).length,m,f=!1,d;for(r==null&&(o=i(d=s())),u=0;u<=c;++u)!(u<c&&n(m=l[u],u,l))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+t(m,u,l),+e(m,u,l));if(d)return o=null,d+""||null}return a.x=function(l){return arguments.length?(t=typeof l=="function"?l:ne(+l),a):t},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:ne(+l),a):e},a.defined=function(l){return arguments.length?(n=typeof l=="function"?l:ne(!!l),a):n},a.curve=function(l){return arguments.length?(i=l,r!=null&&(o=i(r)),a):i},a.context=function(l){return arguments.length?(l==null?r=o=null:o=i(r=l),a):r},a}function oa(t){return t<0?-1:1}function sa(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),s=(n-t._y1)/(i||r<0&&-0),a=(o*i+s*r)/(r+i);return(oa(o)+oa(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function aa(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function jr(t,e,n){var r=t._x0,i=t._y0,o=t._x1,s=t._y1,a=(o-r)/3;t._context.bezierCurveTo(r+a,i+a*e,o-a,s-a*n,o,s)}function Bn(t){this._context=t}Bn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:jr(this,this._t0,aa(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,jr(this,aa(this,n=sa(this,t,e)),n);break;default:jr(this,this._t0,n=sa(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function wf(t){this._context=new la(t)}(wf.prototype=Object.create(Bn.prototype)).point=function(t,e){Bn.prototype.point.call(this,e,t)};function la(t){this._context=t}la.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}};function qn(t){return new Bn(t)}var Je=t=>()=>t;function ti(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function vt(t,e,n){this.k=t,this.x=e,this.y=n}vt.prototype={constructor:vt,scale:function(t){return t===1?this:new vt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new vt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var je=new vt(1,0,0);ei.prototype=vt.prototype;function ei(t){for(;!t.__zoom;)if(!(t=t.parentNode))return je;return t.__zoom}function Xn(t){t.stopImmediatePropagation()}function ve(t){t.preventDefault(),t.stopImmediatePropagation()}function bf(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function _f(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ua(){return this.__zoom||je}function Sf(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Mf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Tf(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function ni(){var t=bf,e=_f,n=Tf,r=Sf,i=Mf,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=xr,u=Ht("start","zoom","end"),c,m,f,d=500,N=150,O=0,x=10;function g(h){h.property("__zoom",ua).on("wheel.zoom",U,{passive:!1}).on("mousedown.zoom",G).on("dblclick.zoom",W).filter(i).on("touchstart.zoom",D).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",P).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(h,_,p,w){var A=h.selection?h.selection():h;A.property("__zoom",ua),h!==A?T(h,_,p,w):A.interrupt().each(function(){b(this,arguments).event(w).start().zoom(null,typeof _=="function"?_.apply(this,arguments):_).end()})},g.scaleBy=function(h,_,p,w){g.scaleTo(h,function(){var A=this.__zoom.k,k=typeof _=="function"?_.apply(this,arguments):_;return A*k},p,w)},g.scaleTo=function(h,_,p,w){g.transform(h,function(){var A=e.apply(this,arguments),k=this.__zoom,E=p==null?C(A):typeof p=="function"?p.apply(this,arguments):p,z=k.invert(E),L=typeof _=="function"?_.apply(this,arguments):_;return n(v(S(k,L),E,z),A,s)},p,w)},g.translateBy=function(h,_,p,w){g.transform(h,function(){return n(this.__zoom.translate(typeof _=="function"?_.apply(this,arguments):_,typeof p=="function"?p.apply(this,arguments):p),e.apply(this,arguments),s)},null,w)},g.translateTo=function(h,_,p,w,A){g.transform(h,function(){var k=e.apply(this,arguments),E=this.__zoom,z=w==null?C(k):typeof w=="function"?w.apply(this,arguments):w;return n(je.translate(z[0],z[1]).scale(E.k).translate(typeof _=="function"?-_.apply(this,arguments):-_,typeof p=="function"?-p.apply(this,arguments):-p),k,s)},w,A)};function S(h,_){return _=Math.max(o[0],Math.min(o[1],_)),_===h.k?h:new vt(_,h.x,h.y)}function v(h,_,p){var w=_[0]-p[0]*h.k,A=_[1]-p[1]*h.k;return w===h.x&&A===h.y?h:new vt(h.k,w,A)}function C(h){return[(+h[0][0]+ +h[1][0])/2,(+h[0][1]+ +h[1][1])/2]}function T(h,_,p,w){h.on("start.zoom",function(){b(this,arguments).event(w).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(w).end()}).tween("zoom",function(){var A=this,k=arguments,E=b(A,k).event(w),z=e.apply(A,k),L=p==null?C(z):typeof p=="function"?p.apply(A,k):p,ot=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),V=A.__zoom,tt=typeof _=="function"?_.apply(A,k):_,st=l(V.invert(L).concat(ot/V.k),tt.invert(L).concat(ot/tt.k));return function(q){if(q===1)q=tt;else{var nt=st(q),M=ot/nt[2];q=new vt(M,L[0]-nt[0]*M,L[1]-nt[1]*M)}E.zoom(null,q)}})}function b(h,_,p){return!p&&h.__zooming||new I(h,_)}function I(h,_){this.that=h,this.args=_,this.active=0,this.sourceEvent=null,this.extent=e.apply(h,_),this.taps=0}I.prototype={event:function(h){return h&&(this.sourceEvent=h),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(h,_){return this.mouse&&h!=="mouse"&&(this.mouse[1]=_.invert(this.mouse[0])),this.touch0&&h!=="touch"&&(this.touch0[1]=_.invert(this.touch0[0])),this.touch1&&h!=="touch"&&(this.touch1[1]=_.invert(this.touch1[0])),this.that.__zoom=_,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(h){var _=J(this.that).datum();u.call(h,this.that,new ti(h,{sourceEvent:this.sourceEvent,target:g,type:h,transform:this.that.__zoom,dispatch:u}),_)}};function U(h,..._){if(!t.apply(this,arguments))return;var p=b(this,_).event(h),w=this.__zoom,A=Math.max(o[0],Math.min(o[1],w.k*Math.pow(2,r.apply(this,arguments)))),k=dt(h);if(p.wheel)(p.mouse[0][0]!==k[0]||p.mouse[0][1]!==k[1])&&(p.mouse[1]=w.invert(p.mouse[0]=k)),clearTimeout(p.wheel);else{if(w.k===A)return;p.mouse=[k,w.invert(k)],bt(this),p.start()}ve(h),p.wheel=setTimeout(E,N),p.zoom("mouse",n(v(S(w,A),p.mouse[0],p.mouse[1]),p.extent,s));function E(){p.wheel=null,p.end()}}function G(h,..._){if(f||!t.apply(this,arguments))return;var p=h.currentTarget,w=b(this,_,!0).event(h),A=J(h.view).on("mousemove.zoom",L,!0).on("mouseup.zoom",ot,!0),k=dt(h,p),E=h.clientX,z=h.clientY;Ce(h.view),Xn(h),w.mouse=[k,this.__zoom.invert(k)],bt(this),w.start();function L(V){if(ve(V),!w.moved){var tt=V.clientX-E,st=V.clientY-z;w.moved=tt*tt+st*st>O}w.event(V).zoom("mouse",n(v(w.that.__zoom,w.mouse[0]=dt(V,p),w.mouse[1]),w.extent,s))}function ot(V){A.on("mousemove.zoom mouseup.zoom",null),De(V.view,w.moved),ve(V),w.event(V).end()}}function W(h,..._){if(t.apply(this,arguments)){var p=this.__zoom,w=dt(h.changedTouches?h.changedTouches[0]:h,this),A=p.invert(w),k=p.k*(h.shiftKey?.5:2),E=n(v(S(p,k),w,A),e.apply(this,_),s);ve(h),a>0?J(this).transition().duration(a).call(T,E,w,h):J(this).call(g.transform,E,w,h)}}function D(h,..._){if(t.apply(this,arguments)){var p=h.touches,w=p.length,A=b(this,_,h.changedTouches.length===w).event(h),k,E,z,L;for(Xn(h),E=0;E<w;++E)z=p[E],L=dt(z,this),L=[L,this.__zoom.invert(L),z.identifier],A.touch0?!A.touch1&&A.touch0[2]!==L[2]&&(A.touch1=L,A.taps=0):(A.touch0=L,k=!0,A.taps=1+!!c);c&&(c=clearTimeout(c)),k&&(A.taps<2&&(m=L[0],c=setTimeout(function(){c=null},d)),bt(this),A.start())}}function Y(h,..._){if(this.__zooming){var p=b(this,_).event(h),w=h.changedTouches,A=w.length,k,E,z,L;for(ve(h),k=0;k<A;++k)E=w[k],z=dt(E,this),p.touch0&&p.touch0[2]===E.identifier?p.touch0[0]=z:p.touch1&&p.touch1[2]===E.identifier&&(p.touch1[0]=z);if(E=p.that.__zoom,p.touch1){var ot=p.touch0[0],V=p.touch0[1],tt=p.touch1[0],st=p.touch1[1],q=(q=tt[0]-ot[0])*q+(q=tt[1]-ot[1])*q,nt=(nt=st[0]-V[0])*nt+(nt=st[1]-V[1])*nt;E=S(E,Math.sqrt(q/nt)),z=[(ot[0]+tt[0])/2,(ot[1]+tt[1])/2],L=[(V[0]+st[0])/2,(V[1]+st[1])/2]}else if(p.touch0)z=p.touch0[0],L=p.touch0[1];else return;p.zoom("touch",n(v(E,z,L),p.extent,s))}}function P(h,..._){if(this.__zooming){var p=b(this,_).event(h),w=h.changedTouches,A=w.length,k,E;for(Xn(h),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),k=0;k<A;++k)E=w[k],p.touch0&&p.touch0[2]===E.identifier?delete p.touch0:p.touch1&&p.touch1[2]===E.identifier&&delete p.touch1;if(p.touch1&&!p.touch0&&(p.touch0=p.touch1,delete p.touch1),p.touch0)p.touch0[1]=this.__zoom.invert(p.touch0[0]);else if(p.end(),p.taps===2&&(E=dt(E,this),Math.hypot(m[0]-E[0],m[1]-E[1])<x)){var z=J(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return g.wheelDelta=function(h){return arguments.length?(r=typeof h=="function"?h:Je(+h),g):r},g.filter=function(h){return arguments.length?(t=typeof h=="function"?h:Je(!!h),g):t},g.touchable=function(h){return arguments.length?(i=typeof h=="function"?h:Je(!!h),g):i},g.extent=function(h){return arguments.length?(e=typeof h=="function"?h:Je([[+h[0][0],+h[0][1]],[+h[1][0],+h[1][1]]]),g):e},g.scaleExtent=function(h){return arguments.length?(o[0]=+h[0],o[1]=+h[1],g):[o[0],o[1]]},g.translateExtent=function(h){return arguments.length?(s[0][0]=+h[0][0],s[1][0]=+h[1][0],s[0][1]=+h[0][1],s[1][1]=+h[1][1],g):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},g.constrain=function(h){return arguments.length?(n=h,g):n},g.duration=function(h){return arguments.length?(a=+h,g):a},g.interpolate=function(h){return arguments.length?(l=h,g):l},g.on=function(){var h=u.on.apply(u,arguments);return h===u?g:h},g.clickDistance=function(h){return arguments.length?(O=(h=+h)*h,g):Math.sqrt(O)},g.tapDistance=function(h){return arguments.length?(x=+h,g):x},g}var Gn=class{constructor(e,n={}){this.container=J(e),this.options={width:800,height:400,margin:{top:20,right:30,bottom:40,left:50},animationDuration:500,showTooltip:!0,enableZoom:!0,enableBrush:!0,colorScheme:"category10",severityColors:{low:"#28a745",medium:"#ffc107",high:"#fd7e14",critical:"#dc3545"},...n},this.data=[],this.filteredData=[],this.selectedTimeRange=null,this.brushSelection=null,this.init()}init(){this.setupDimensions(),this.createSVG(),this.createScales(),this.createAxes(),this.createTooltip(),this.createBrush(),this.createZoom(),this.setupEventListeners()}setupDimensions(){this.width=this.options.width-this.options.margin.left-this.options.margin.right,this.height=this.options.height-this.options.margin.top-this.options.margin.bottom}createSVG(){this.container.selectAll("*").remove(),this.svg=this.container.append("svg").attr("width",this.options.width).attr("height",this.options.height).attr("class","anomaly-timeline"),this.g=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.svg.append("defs").append("clipPath").attr("id","timeline-clip").append("rect").attr("width",this.width).attr("height",this.height),this.chartArea=this.g.append("g").attr("clip-path","url(#timeline-clip)")}createScales(){this.xScale=Fn().range([0,this.width]),this.yScale=qe().range([this.height,0]),this.colorScale=Ye(Jr),this.sizeScale=Yr().range([3,15])}createAxes(){this.xAxis=nr(this.xScale).tickFormat(ee("%H:%M")),this.yAxis=rr(this.yScale).tickFormat(fe(".2f")),this.g.append("g").attr("class","x-axis").attr("transform",`translate(0,${this.height})`),this.g.append("g").attr("class","y-axis"),this.g.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",0-this.options.margin.left).attr("x",0-this.height/2).attr("dy","1em").style("text-anchor","middle").text("Anomaly Score"),this.g.append("text").attr("class","axis-label").attr("transform",`translate(${this.width/2}, ${this.height+this.options.margin.bottom})`).style("text-anchor","middle").text("Time")}createTooltip(){this.options.showTooltip&&(this.tooltip=J("body").append("div").attr("class","anomaly-timeline-tooltip").style("opacity",0).style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("pointer-events","none").style("font-size","12px").style("z-index","1000"))}createBrush(){this.options.enableBrush&&(this.brush=Mr().extent([[0,0],[this.width,this.height]]).on("start brush end",this.onBrush.bind(this)),this.brushGroup=this.g.append("g").attr("class","brush").call(this.brush))}createZoom(){this.options.enableZoom&&(this.zoom=ni().scaleExtent([1,10]).translateExtent([[0,0],[this.width,this.height]]).on("zoom",this.onZoom.bind(this)),this.svg.call(this.zoom))}setupEventListeners(){window.addEventListener("resize",this.debounce(this.resize.bind(this),250))}setData(e){this.data=e.map(n=>({...n,timestamp:new Date(n.timestamp),score:+n.score,severity:n.severity||this.getSeverityFromScore(n.score)})),this.filteredData=[...this.data],this.updateScales(),this.render()}getSeverityFromScore(e){return e>=.8?"critical":e>=.6?"high":e>=.4?"medium":"low"}updateScales(){if(this.filteredData.length===0)return;let e=be(this.filteredData,r=>r.timestamp),n=be(this.filteredData,r=>r.score);this.xScale.domain(e),this.yScale.domain([0,Math.max(1,n[1])]),this.sizeScale.domain([0,n[1]])}render(){this.renderAxes(),this.renderAnomalies(),this.renderTrend(),this.renderLegend()}renderAxes(){this.g.select(".x-axis").transition().duration(this.options.animationDuration).call(this.xAxis),this.g.select(".y-axis").transition().duration(this.options.animationDuration).call(this.yAxis)}renderAnomalies(){let e=this.chartArea.selectAll(".anomaly-point").data(this.filteredData,r=>r.id||r.timestamp);e.enter().append("circle").attr("class","anomaly-point").attr("cx",r=>this.xScale(r.timestamp)).attr("cy",this.height).attr("r",0).style("fill",r=>this.options.severityColors[r.severity]).style("opacity",.7).style("cursor","pointer").merge(e).transition().duration(this.options.animationDuration).attr("cx",r=>this.xScale(r.timestamp)).attr("cy",r=>this.yScale(r.score)).attr("r",r=>this.sizeScale(r.score)).style("fill",r=>this.options.severityColors[r.severity]),e.exit().transition().duration(this.options.animationDuration).attr("r",0).style("opacity",0).remove(),this.chartArea.selectAll(".anomaly-point").on("mouseover",this.showTooltip.bind(this)).on("mouseout",this.hideTooltip.bind(this)).on("click",this.onAnomalyClick.bind(this))}renderTrend(){if(this.filteredData.length<2)return;let e=Yn().x(o=>this.xScale(o.timestamp)).y(o=>this.yScale(o.movingAverage||o.score)).curve(qn),n=Math.max(3,Math.floor(this.filteredData.length/10)),r=this.calculateMovingAverage(this.filteredData,n),i=this.chartArea.selectAll(".trend-line").data([r]);i.enter().append("path").attr("class","trend-line").style("fill","none").style("stroke","#666").style("stroke-width",2).style("opacity",.5).merge(i).transition().duration(this.options.animationDuration).attr("d",e),i.exit().remove()}renderLegend(){let n=this.g.selectAll(".legend").data([null]).enter().append("g").attr("class","legend").attr("transform",`translate(${this.width-120}, 20)`),r=Object.keys(this.options.severityColors),o=n.selectAll(".legend-item").data(r).enter().append("g").attr("class","legend-item").attr("transform",(s,a)=>`translate(0, ${a*20})`);o.append("circle").attr("r",6).style("fill",s=>this.options.severityColors[s]),o.append("text").attr("x",12).attr("y",5).style("font-size","12px").text(s=>s.charAt(0).toUpperCase()+s.slice(1))}calculateMovingAverage(e,n){return e.map((r,i)=>{let o=Math.max(0,i-n+1),s=e.slice(o,i+1),a=s.reduce((l,u)=>l+u.score,0)/s.length;return{...r,movingAverage:a}})}showTooltip(e,n){this.tooltip&&(this.tooltip.transition().duration(200).style("opacity",.9),this.tooltip.html(`
            <strong>Anomaly Details</strong><br/>
            Time: ${ee("%Y-%m-%d %H:%M:%S")(n.timestamp)}<br/>
            Score: ${n.score.toFixed(3)}<br/>
            Severity: ${n.severity}<br/>
            ${n.description?`Description: ${n.description}<br/>`:""}
            ${n.features?`Features: ${n.features.join(", ")}<br/>`:""}
        `).style("left",e.pageX+10+"px").style("top",e.pageY-28+"px"))}hideTooltip(){this.tooltip&&this.tooltip.transition().duration(500).style("opacity",0)}onAnomalyClick(e,n){this.container.node().dispatchEvent(new CustomEvent("anomalySelected",{detail:{anomaly:n,timeline:this}}))}onBrush(e){e.selection?(this.brushSelection=e.selection.map(this.xScale.invert),this.filteredData=this.data.filter(n=>n.timestamp>=this.brushSelection[0]&&n.timestamp<=this.brushSelection[1])):(this.brushSelection=null,this.filteredData=[...this.data]),this.updateScales(),this.renderAnomalies(),this.renderTrend(),this.container.node().dispatchEvent(new CustomEvent("timeRangeFiltered",{detail:{range:this.brushSelection,data:this.filteredData}}))}onZoom(e){let n=e.transform.rescaleX(this.xScale);this.g.select(".x-axis").call(this.xAxis.scale(n)),this.chartArea.selectAll(".anomaly-point").attr("cx",r=>n(r.timestamp)),this.chartArea.selectAll(".trend-line").attr("d",Yn().x(r=>n(r.timestamp)).y(r=>this.yScale(r.movingAverage||r.score)).curve(qn))}resize(){let n=this.container.node().getBoundingClientRect().width;n!==this.options.width&&(this.options.width=n,this.setupDimensions(),this.createSVG(),this.createScales(),this.createAxes(),this.updateScales(),this.render())}filterByTimeRange(e,n){this.filteredData=this.data.filter(r=>r.timestamp>=e&&r.timestamp<=n),this.updateScales(),this.render()}filterBySeverity(e){this.filteredData=this.data.filter(n=>e.includes(n.severity)),this.updateScales(),this.render()}highlightAnomalies(e){this.chartArea.selectAll(".anomaly-point").style("stroke",n=>e.includes(n.id)?"#000":"none").style("stroke-width",n=>e.includes(n.id)?2:0)}addRealTimeData(e){let n=e.map(i=>({...i,timestamp:new Date(i.timestamp),score:+i.score,severity:i.severity||this.getSeverityFromScore(i.score)}));this.data.push(...n);let r=1e3;this.data.length>r&&(this.data=this.data.slice(-r)),this.filteredData=[...this.data],this.updateScales(),this.render()}exportData(){return{data:this.data,filteredData:this.filteredData,timeRange:this.brushSelection,config:this.options}}debounce(e,n){let r;return function(...o){let s=()=>{clearTimeout(r),e(...o)};clearTimeout(r),r=setTimeout(s,n)}}destroy(){this.tooltip&&this.tooltip.remove(),window.removeEventListener("resize",this.resize),this.container.selectAll("*").remove()}};var Vn=class{constructor(e,n={}){this.container=typeof e=="string"?document.querySelector(e):e,this.options={columns:12,rowHeight:60,margin:[10,10],containerPadding:[10,10],maxRows:1/0,isDraggable:!0,isResizable:!0,preventCollision:!1,autoSize:!0,compactType:"vertical",layouts:{},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},responsiveLayouts:{lg:[],md:[],sm:[],xs:[],xxs:[]},...n},this.widgets=new Map,this.layout=[],this.currentBreakpoint="lg",this.isDragging=!1,this.isResizing=!1,this.draggedWidget=null,this.placeholder=null,this.init()}init(){this.setupContainer(),this.detectBreakpoint(),this.bindEvents(),this.render()}setupContainer(){this.container.classList.add("dashboard-layout"),this.container.innerHTML="",this.gridOverlay=document.createElement("div"),this.gridOverlay.className="grid-overlay",this.gridOverlay.style.display="none",this.container.appendChild(this.gridOverlay),Object.assign(this.container.style,{position:"relative",minHeight:"100vh",padding:`${this.options.containerPadding[1]}px ${this.options.containerPadding[0]}px`})}detectBreakpoint(){let e=this.container.clientWidth;for(let[n,r]of Object.entries(this.options.breakpoints))if(e>=r){this.currentBreakpoint=n;break}this.loadLayout(this.currentBreakpoint)}bindEvents(){window.ResizeObserver?(this.resizeObserver=new ResizeObserver(()=>{this.detectBreakpoint(),this.render()}),this.resizeObserver.observe(this.container)):window.addEventListener("resize",this.debounce(()=>{this.detectBreakpoint(),this.render()},250)),this.container.addEventListener("mousedown",this.onMouseDown.bind(this)),this.container.addEventListener("mousemove",this.onMouseMove.bind(this)),this.container.addEventListener("mouseup",this.onMouseUp.bind(this)),this.container.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this.container.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.container.addEventListener("touchend",this.onTouchEnd.bind(this)),this.container.addEventListener("keydown",this.onKeyDown.bind(this))}addWidget(e){let n={id:e.id||this.generateId(),type:e.type||"default",title:e.title||"Widget",content:e.content||"",component:e.component||null,props:e.props||{},x:e.x||0,y:e.y||0,w:e.w||2,h:e.h||2,minW:e.minW||1,minH:e.minH||1,maxW:e.maxW||1/0,maxH:e.maxH||1/0,static:e.static||!1,isDraggable:e.isDraggable!==!1,isResizable:e.isResizable!==!1,moved:!1,resizeHandles:e.resizeHandles||["se"],...e};if(e.x===void 0||e.y===void 0){let r=this.findSuitablePosition(n.w,n.h);n.x=r.x,n.y=r.y}return this.widgets.set(n.id,n),this.layout.push(n),this.options.compactType&&this.compactLayout(),this.render(),this.saveLayout(),this.emitEvent("widgetAdded",{widget:n}),n}removeWidget(e){let n=this.widgets.get(e);if(!n)return!1;this.widgets.delete(e),this.layout=this.layout.filter(i=>i.id!==e);let r=this.container.querySelector(`[data-widget-id="${e}"]`);return r&&r.remove(),this.options.compactType&&this.compactLayout(),this.render(),this.saveLayout(),this.emitEvent("widgetRemoved",{widget:n}),!0}updateWidget(e,n){let r=this.widgets.get(e);if(!r)return!1;Object.assign(r,n);let i=this.layout.findIndex(o=>o.id===e);return i>=0&&(this.layout[i]=r),this.render(),this.saveLayout(),this.emitEvent("widgetUpdated",{widget:r,updates:n}),!0}findSuitablePosition(e,n){let r=this.options.columns;for(let o=0;o<this.options.maxRows;o++)for(let s=0;s<=r-e;s++)if(!this.hasCollision({x:s,y:o,w:e,h:n}))return{x:s,y:o};return{x:0,y:Math.max(0,...this.layout.map(o=>o.y+o.h))}}hasCollision(e,n=null){return this.layout.some(r=>r.id===n?!1:!(e.x>=r.x+r.w||e.x+e.w<=r.x||e.y>=r.y+r.h||e.y+e.h<=r.y))}compactLayout(){this.options.compactType==="vertical"?this.compactVertical():this.options.compactType==="horizontal"&&this.compactHorizontal()}compactVertical(){[...this.layout].sort((n,r)=>n.y===r.y?n.x-r.x:n.y-r.y).forEach(n=>{if(n.static)return;let r=0;for(let i=0;i<n.y;i++){let o={...n,y:i};if(!this.hasCollision(o,n.id))r=i;else break}n.y=r})}compactHorizontal(){[...this.layout].sort((n,r)=>n.x===r.x?n.y-r.y:n.x-r.x).forEach(n=>{if(n.static)return;let r=0;for(let i=0;i<n.x;i++){let o={...n,x:i};if(!this.hasCollision(o,n.id))r=i;else break}n.x=r})}render(){this.container.querySelectorAll(".dashboard-widget").forEach(i=>i.remove());let r=(this.container.clientWidth-this.options.containerPadding[0]*2-this.options.margin[0]*(this.options.columns-1))/this.options.columns;if(this.layout.forEach(i=>{let o=this.createWidgetElement(i,r);this.container.appendChild(o)}),this.options.autoSize){let o=Math.max(0,...this.layout.map(s=>s.y+s.h))*(this.options.rowHeight+this.options.margin[1])+this.options.containerPadding[1]*2;this.container.style.minHeight=`${o}px`}}createWidgetElement(e,n){let r=document.createElement("div");r.className="dashboard-widget",r.setAttribute("data-widget-id",e.id),r.setAttribute("tabindex","0"),r.setAttribute("role","article"),r.setAttribute("aria-label",`Widget: ${e.title}`);let i=e.x*(n+this.options.margin[0]),o=e.y*(this.options.rowHeight+this.options.margin[1]),s=e.w*n+(e.w-1)*this.options.margin[0],a=e.h*this.options.rowHeight+(e.h-1)*this.options.margin[1];Object.assign(r.style,{position:"absolute",left:`${i}px`,top:`${o}px`,width:`${s}px`,height:`${a}px`,backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",overflow:"hidden",transition:this.isDragging||this.isResizing?"none":"all 0.2s ease",cursor:e.isDraggable?"move":"default",zIndex:e.static?1:2});let l=document.createElement("div");l.className="widget-header",l.style.cssText=`
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 44px;
        `;let u=document.createElement("h3");u.className="widget-title",u.textContent=e.title,u.style.cssText=`
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
        `;let c=document.createElement("div");if(c.className="widget-actions",c.style.cssText=`
            display: flex;
            gap: 8px;
        `,!e.static){let f=this.createActionButton("\xD7",()=>this.removeWidget(e.id));f.setAttribute("aria-label","Remove widget"),c.appendChild(f)}l.appendChild(u),l.appendChild(c);let m=document.createElement("div");if(m.className="widget-content",m.style.cssText=`
            padding: 16px;
            height: calc(100% - 44px);
            overflow: auto;
        `,e.component&&typeof e.component=="function"){let f=e.component(e.props);m.appendChild(f)}else e.content?m.innerHTML=e.content:m.innerHTML='<p style="color: #6b7280;">No content available</p>';return r.appendChild(l),r.appendChild(m),e.isResizable&&!e.static&&this.addResizeHandles(r,e),r}createActionButton(e,n){let r=document.createElement("button");return r.textContent=e,r.style.cssText=`
            background: transparent;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        `,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#e5e7eb",r.style.color="#374151"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="transparent",r.style.color="#6b7280"}),r.addEventListener("click",i=>{i.stopPropagation(),n()}),r}addResizeHandles(e,n){n.resizeHandles.forEach(r=>{let i=document.createElement("div");i.className=`resize-handle resize-handle-${r}`,i.style.cssText=this.getResizeHandleStyles(r),i.setAttribute("data-resize-direction",r),i.addEventListener("mousedown",o=>{o.stopPropagation(),this.startResize(o,n,r)}),e.appendChild(i)})}getResizeHandleStyles(e){let n=`
            position: absolute;
            background: #3b82f6;
            opacity: 0;
            transition: opacity 0.2s ease;
            cursor: ${this.getResizeCursor(e)};
        `;switch(e){case"se":return n+`
                    bottom: 0;
                    right: 0;
                    width: 12px;
                    height: 12px;
                    border-radius: 12px 0 0 0;
                `;case"s":return n+`
                    bottom: 0;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 24px;
                    height: 4px;
                `;case"e":return n+`
                    right: 0;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 4px;
                    height: 24px;
                `;default:return n}}getResizeCursor(e){return{se:"nw-resize",s:"ns-resize",e:"ew-resize",ne:"ne-resize",nw:"nw-resize",sw:"sw-resize",n:"ns-resize",w:"ew-resize"}[e]||"default"}onMouseDown(e){let n=e.target.closest(".dashboard-widget");if(!n)return;let r=n.getAttribute("data-widget-id"),i=this.widgets.get(r);!i||i.static||!i.isDraggable||e.target.classList.contains("resize-handle")||this.startDrag(e,i)}startDrag(e,n){this.isDragging=!0,this.draggedWidget=n;let r=this.container.querySelector(`[data-widget-id="${n.id}"]`),i=r.getBoundingClientRect(),o=this.container.getBoundingClientRect();this.dragOffset={x:e.clientX-i.left,y:e.clientY-i.top},this.showGridOverlay(),r.classList.add("dragging"),this.createPlaceholder(n),this.emitEvent("dragStart",{widget:n})}startResize(e,n,r){this.isResizing=!0,this.draggedWidget=n,this.resizeDirection=r,this.container.querySelector(`[data-widget-id="${n.id}"]`).classList.add("resizing"),this.emitEvent("resizeStart",{widget:n,direction:r})}onMouseMove(e){this.isDragging?this.handleDrag(e):this.isResizing&&this.handleResize(e)}handleDrag(e){if(!this.draggedWidget)return;let n=this.container.getBoundingClientRect(),r=(this.container.clientWidth-this.options.containerPadding[0]*2-this.options.margin[0]*(this.options.columns-1))/this.options.columns,i=Math.round((e.clientX-n.left-this.dragOffset.x)/(r+this.options.margin[0])),o=Math.round((e.clientY-n.top-this.dragOffset.y)/(this.options.rowHeight+this.options.margin[1])),s=Math.max(0,Math.min(i,this.options.columns-this.draggedWidget.w)),a=Math.max(0,o);this.placeholder&&(this.placeholder.x=s,this.placeholder.y=a,this.updatePlaceholderPosition())}handleResize(e){if(!this.draggedWidget)return;let n=this.container.getBoundingClientRect(),r=(this.container.clientWidth-this.options.containerPadding[0]*2-this.options.margin[0]*(this.options.columns-1))/this.options.columns,i=this.draggedWidget,o=this.resizeDirection,s=i.w,a=i.h;if(o.includes("e")){let m=e.clientX-n.left-i.x*(r+this.options.margin[0]);s=Math.max(i.minW,Math.min(i.maxW,Math.round(m/(r+this.options.margin[0]))))}if(o.includes("s")){let m=e.clientY-n.top-i.y*(this.options.rowHeight+this.options.margin[1]);a=Math.max(i.minH,Math.min(i.maxH,Math.round(m/(this.options.rowHeight+this.options.margin[1]))))}let l=this.container.querySelector(`[data-widget-id="${i.id}"]`),u=s*r+(s-1)*this.options.margin[0],c=a*this.options.rowHeight+(a-1)*this.options.margin[1];l.style.width=`${u}px`,l.style.height=`${c}px`}onMouseUp(e){this.isDragging?this.endDrag():this.isResizing&&this.endResize()}endDrag(){if(!this.draggedWidget||!this.placeholder)return;let e=this.draggedWidget;e.x=this.placeholder.x,e.y=this.placeholder.y,e.moved=!0,this.container.querySelector(`[data-widget-id="${e.id}"]`).classList.remove("dragging"),this.removePlaceholder(),this.hideGridOverlay(),this.options.preventCollision||this.resolveCollisions(e),this.options.compactType&&this.compactLayout(),this.render(),this.saveLayout(),this.emitEvent("dragEnd",{widget:e}),this.isDragging=!1,this.draggedWidget=null}endResize(){if(!this.draggedWidget)return;let e=this.draggedWidget,n=this.container.querySelector(`[data-widget-id="${e.id}"]`),i=(this.container.clientWidth-this.options.containerPadding[0]*2-this.options.margin[0]*(this.options.columns-1))/this.options.columns,o=parseInt(n.style.width),s=parseInt(n.style.height);e.w=Math.round(o/(i+this.options.margin[0])),e.h=Math.round(s/(this.options.rowHeight+this.options.margin[1])),n.classList.remove("resizing"),this.options.preventCollision||this.resolveCollisions(e),this.options.compactType&&this.compactLayout(),this.render(),this.saveLayout(),this.emitEvent("resizeEnd",{widget:e}),this.isResizing=!1,this.draggedWidget=null,this.resizeDirection=null}resolveCollisions(e){this.layout.filter(r=>r.id!==e.id&&!r.static&&this.hasCollision(e,r.id)).forEach(r=>{r.y=e.y+e.h,r.moved=!0})}createPlaceholder(e){this.placeholder={x:e.x,y:e.y,w:e.w,h:e.h};let n=document.createElement("div");n.className="widget-placeholder",n.style.cssText=`
            position: absolute;
            background: rgba(59, 130, 246, 0.2);
            border: 2px dashed #3b82f6;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
        `,this.placeholderElement=n,this.container.appendChild(n),this.updatePlaceholderPosition()}updatePlaceholderPosition(){if(!this.placeholderElement||!this.placeholder)return;let n=(this.container.clientWidth-this.options.containerPadding[0]*2-this.options.margin[0]*(this.options.columns-1))/this.options.columns,r=this.placeholder.x*(n+this.options.margin[0]),i=this.placeholder.y*(this.options.rowHeight+this.options.margin[1]),o=this.placeholder.w*n+(this.placeholder.w-1)*this.options.margin[0],s=this.placeholder.h*this.options.rowHeight+(this.placeholder.h-1)*this.options.margin[1];Object.assign(this.placeholderElement.style,{left:`${r}px`,top:`${i}px`,width:`${o}px`,height:`${s}px`})}removePlaceholder(){this.placeholderElement&&(this.placeholderElement.remove(),this.placeholderElement=null),this.placeholder=null}showGridOverlay(){this.gridOverlay.style.display="block"}hideGridOverlay(){this.gridOverlay.style.display="none"}onTouchStart(e){if(e.touches.length===1){e.preventDefault();let n=e.touches[0];this.onMouseDown({...n,target:n.target,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()})}}onTouchMove(e){if(e.touches.length===1&&(this.isDragging||this.isResizing)){e.preventDefault();let n=e.touches[0];this.onMouseMove(n)}}onTouchEnd(e){this.onMouseUp(e)}onKeyDown(e){let n=e.target.closest(".dashboard-widget");if(!n)return;let r=n.getAttribute("data-widget-id"),i=this.widgets.get(r);if(!i||i.static)return;let o=!1,s=e.shiftKey?5:1;switch(e.key){case"ArrowLeft":i.x=Math.max(0,i.x-s),o=!0;break;case"ArrowRight":i.x=Math.min(this.options.columns-i.w,i.x+s),o=!0;break;case"ArrowUp":i.y=Math.max(0,i.y-s),o=!0;break;case"ArrowDown":i.y=i.y+s,o=!0;break;case"Delete":case"Backspace":this.removeWidget(r),e.preventDefault();return}if(o){if(e.preventDefault(),this.hasCollision(i,i.id)){switch(e.key){case"ArrowLeft":i.x+=s;break;case"ArrowRight":i.x-=s;break;case"ArrowUp":i.y+=s;break;case"ArrowDown":i.y-=s;break}return}this.render(),this.saveLayout(),this.emitEvent("widgetMoved",{widget:i})}}saveLayout(){let e={[this.currentBreakpoint]:this.layout.map(n=>({i:n.id,x:n.x,y:n.y,w:n.w,h:n.h,static:n.static}))};try{localStorage.setItem("dashboard-layout",JSON.stringify(e)),this.emitEvent("layoutSaved",{layout:e})}catch(n){console.error("Failed to save layout:",n)}}loadLayout(e){try{let n=localStorage.getItem("dashboard-layout");if(n){let i=JSON.parse(n)[e];i&&(i.forEach(o=>{let s=this.widgets.get(o.i);s&&(s.x=o.x,s.y=o.y,s.w=o.w,s.h=o.h,s.static=o.static)}),this.emitEvent("layoutLoaded",{layout:i}))}}catch(n){console.error("Failed to load layout:",n)}}generateId(){return"widget_"+Math.random().toString(36).substr(2,9)}debounce(e,n){let r;return function(...o){let s=()=>{clearTimeout(r),e(...o)};clearTimeout(r),r=setTimeout(s,n)}}emitEvent(e,n){let r=new CustomEvent(`dashboard:${e}`,{detail:n,bubbles:!0,cancelable:!0});this.container.dispatchEvent(r)}getLayout(){return this.layout.map(e=>({...e}))}setLayout(e){this.layout=e.map(n=>({...n})),this.widgets.clear(),this.layout.forEach(n=>{this.widgets.set(n.id,n)}),this.render(),this.saveLayout()}exportLayout(){return{layout:this.getLayout(),breakpoint:this.currentBreakpoint,options:{...this.options}}}importLayout(e){e.layout&&this.setLayout(e.layout)}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.container.innerHTML="",this.widgets.clear(),this.layout=[]}};var ri=class{constructor(e,n={}){this.container=typeof e=="string"?document.querySelector(e):e,this.options={enableRealTime:!0,updateInterval:1e3,maxDataPoints:1e3,alertThreshold:.7,enableSound:!1,enableNotifications:!0,autoScroll:!0,theme:"light",...n},this.wsClient=null,this.dashboardLayout=null,this.timeline=null,this.isActive=!1,this.lastUpdate=null,this.data={realTimeData:[],alerts:[],systemMetrics:{},connectionStatus:"disconnected",statistics:{totalAnomalies:0,criticalAlerts:0,avgScore:0,detectionRate:0}},this.charts=new Map,this.widgets=new Map,this.updateTimers=new Map,this.init()}init(){this.setupContainer(),this.initializeWebSocket(),this.createDashboardLayout(),this.bindEvents(),this.options.enableRealTime&&this.start()}setupContainer(){this.container.classList.add("real-time-dashboard"),this.container.innerHTML="",this.header=document.createElement("div"),this.header.className="dashboard-header",this.header.innerHTML=`
            <div class="dashboard-title">
                <h2>Real-Time Anomaly Detection</h2>
                <div class="connection-status" id="connection-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            <div class="dashboard-controls">
                <button class="btn btn-primary" id="start-btn">Start Monitoring</button>
                <button class="btn btn-secondary" id="pause-btn" disabled>Pause</button>
                <button class="btn btn-ghost" id="settings-btn">Settings</button>
                <button class="btn btn-ghost" id="fullscreen-btn">\u26F6</button>
            </div>
        `,this.content=document.createElement("div"),this.content.className="dashboard-content",this.container.appendChild(this.header),this.container.appendChild(this.content)}initializeWebSocket(){this.wsClient=new tn({enableLogging:!0,autoConnect:!1,enableRealTimeDetection:!0,enableAlerts:!0,enableMetrics:!0}),this.wsClient.on("connected",()=>{this.updateConnectionStatus("connected"),this.onWebSocketConnected()}),this.wsClient.on("disconnected",()=>{this.updateConnectionStatus("disconnected"),this.onWebSocketDisconnected()}),this.wsClient.on("anomaly_detected",e=>{this.onAnomalyDetected(e)}),this.wsClient.on("real_time_data",e=>{this.onRealTimeData(e)}),this.wsClient.on("alert",e=>{this.onAlert(e)}),this.wsClient.on("system_metrics",e=>{this.onSystemMetrics(e)})}createDashboardLayout(){this.dashboardLayout=new Vn(this.content,{columns:12,rowHeight:80,margin:[10,10],isDraggable:!0,isResizable:!0}),this.addWidget({id:"connection-info",title:"Connection Status",type:"status",x:0,y:0,w:3,h:2,component:()=>this.createConnectionWidget()}),this.addWidget({id:"live-timeline",title:"Live Anomaly Timeline",type:"chart",x:3,y:0,w:9,h:6,component:()=>this.createTimelineWidget()}),this.addWidget({id:"statistics",title:"Detection Statistics",type:"metrics",x:0,y:2,w:3,h:4,component:()=>this.createStatisticsWidget()}),this.addWidget({id:"live-alerts",title:"Live Alerts",type:"alerts",x:0,y:6,w:6,h:4,component:()=>this.createAlertsWidget()}),this.addWidget({id:"system-metrics",title:"System Metrics",type:"metrics",x:6,y:6,w:6,h:4,component:()=>this.createSystemMetricsWidget()}),this.addWidget({id:"data-stream",title:"Data Stream",type:"stream",x:0,y:10,w:12,h:3,component:()=>this.createDataStreamWidget()})}addWidget(e){return this.dashboardLayout.addWidget(e),e.id}createConnectionWidget(){let e=document.createElement("div");e.className="connection-widget";let n=()=>{let r=this.wsClient.getConnectionInfo();e.innerHTML=`
                <div class="connection-info">
                    <div class="status-row">
                        <span class="label">Status:</span>
                        <span class="value status-${r.state}">${r.state}</span>
                    </div>
                    <div class="status-row">
                        <span class="label">Connection ID:</span>
                        <span class="value">${r.connectionId||"N/A"}</span>
                    </div>
                    <div class="status-row">
                        <span class="label">Subscriptions:</span>
                        <span class="value">${r.subscriptions.length}</span>
                    </div>
                    <div class="status-row">
                        <span class="label">Queued:</span>
                        <span class="value">${r.queuedMessages}</span>
                    </div>
                    ${r.state==="connecting"?`
                        <div class="status-row">
                            <span class="label">Attempts:</span>
                            <span class="value">${r.reconnectAttempts}</span>
                        </div>
                    `:""}
                </div>
            `};return n(),this.updateTimers.set("connection",setInterval(n,2e3)),e}createTimelineWidget(){let e=document.createElement("div");return e.className="timeline-widget",e.style.height="100%",this.timeline=new Gn(e,{width:e.clientWidth||800,height:400,enableRealTime:!0,enableZoom:!0,enableBrush:!0,maxDataPoints:this.options.maxDataPoints}),e}createStatisticsWidget(){let e=document.createElement("div");e.className="statistics-widget";let n=()=>{let r=this.data.statistics;e.innerHTML=`
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${r.totalAnomalies}</div>
                        <div class="stat-label">Total Anomalies</div>
                    </div>
                    <div class="stat-item critical">
                        <div class="stat-value">${r.criticalAlerts}</div>
                        <div class="stat-label">Critical Alerts</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${r.avgScore.toFixed(3)}</div>
                        <div class="stat-label">Avg Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${r.detectionRate.toFixed(1)}/min</div>
                        <div class="stat-label">Detection Rate</div>
                    </div>
                </div>
            `};return n(),this.updateTimers.set("statistics",setInterval(n,1e3)),e}createAlertsWidget(){let e=document.createElement("div");e.className="alerts-widget",e.innerHTML=`
            <div class="alerts-header">
                <span class="alerts-count">0 active alerts</span>
                <button class="btn btn-sm btn-ghost" id="clear-alerts">Clear All</button>
            </div>
            <div class="alerts-list" id="alerts-list"></div>
        `,e.querySelector("#clear-alerts").onclick=()=>{this.clearAlerts()};let n=()=>{let r=e.querySelector("#alerts-list"),i=e.querySelector(".alerts-count"),o=this.wsClient.getUnacknowledgedAlerts();i.textContent=`${o.length} active alerts`,r.innerHTML=o.slice(0,10).map(s=>`
                <div class="alert-item severity-${s.severity}" data-alert-id="${s.id}">
                    <div class="alert-content">
                        <div class="alert-message">${s.message}</div>
                        <div class="alert-time">${new Date(s.timestamp).toLocaleTimeString()}</div>
                    </div>
                    <button class="alert-dismiss" onclick="dashboard.acknowledgeAlert('${s.id}')">\xD7</button>
                </div>
            `).join("")};return n(),this.updateTimers.set("alerts",setInterval(n,500)),e}createSystemMetricsWidget(){let e=document.createElement("div");e.className="system-metrics-widget";let n=()=>{let r=this.data.systemMetrics;e.innerHTML=`
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">CPU Usage</div>
                        <div class="metric-value">${(r.cpu*100).toFixed(1)}%</div>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: ${r.cpu*100}%"></div>
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Memory Usage</div>
                        <div class="metric-value">${(r.memory*100).toFixed(1)}%</div>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: ${r.memory*100}%"></div>
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Active Models</div>
                        <div class="metric-value">${r.activeModels||0}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Queue Size</div>
                        <div class="metric-value">${r.queueSize||0}</div>
                    </div>
                </div>
            `};return n(),this.updateTimers.set("system-metrics",setInterval(n,2e3)),e}createDataStreamWidget(){let e=document.createElement("div");e.className="data-stream-widget",e.innerHTML=`
            <div class="stream-header">
                <span>Live Data Stream</span>
                <div class="stream-controls">
                    <button class="btn btn-sm" id="pause-stream">Pause</button>
                    <button class="btn btn-sm" id="clear-stream">Clear</button>
                </div>
            </div>
            <div class="stream-content" id="stream-content"></div>
        `;let n=e.querySelector("#stream-content"),r=!1;e.querySelector("#pause-stream").onclick=o=>{r=!r,o.target.textContent=r?"Resume":"Pause"},e.querySelector("#clear-stream").onclick=()=>{n.innerHTML=""};let i=()=>{if(r)return;let o=this.data.realTimeData.slice(-50);n.innerHTML=o.map(s=>`
                <div class="stream-item">
                    <span class="stream-time">${new Date(s.timestamp).toLocaleTimeString()}</span>
                    <span class="stream-data">${JSON.stringify(s.data).substring(0,100)}</span>
                    ${s.anomaly?'<span class="stream-anomaly">\u26A0\uFE0F</span>':""}
                </div>
            `).join(""),this.options.autoScroll&&(n.scrollTop=n.scrollHeight)};return this.updateTimers.set("stream",setInterval(i,1e3)),e}bindEvents(){this.header.querySelector("#start-btn").onclick=()=>this.start(),this.header.querySelector("#pause-btn").onclick=()=>this.pause(),this.header.querySelector("#settings-btn").onclick=()=>this.showSettings(),this.header.querySelector("#fullscreen-btn").onclick=()=>this.toggleFullscreen(),document.addEventListener("keydown",e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"p":e.preventDefault(),this.isActive?this.pause():this.start();break;case"r":e.preventDefault(),this.refresh();break;case"f":e.preventDefault(),this.toggleFullscreen();break}})}onWebSocketConnected(){console.log("Real-time dashboard connected"),this.updateStatistics()}onWebSocketDisconnected(){console.log("Real-time dashboard disconnected")}onAnomalyDetected(e){this.timeline&&this.timeline.addRealTimeData([e]),this.data.statistics.totalAnomalies++,e.severity==="critical"&&this.data.statistics.criticalAlerts++;let n=this.data.realTimeData.filter(r=>r.anomaly).slice(-100).map(r=>r.anomaly.score);n.length>0&&(this.data.statistics.avgScore=n.reduce((r,i)=>r+i)/n.length),this.options.enableSound&&e.severity==="critical"&&this.playNotificationSound(),this.options.enableNotifications&&e.severity==="critical"&&this.showBrowserNotification(e)}onRealTimeData(e){this.data.realTimeData.push({...e,timestamp:Date.now()}),this.data.realTimeData.length>this.options.maxDataPoints&&this.data.realTimeData.shift(),this.lastUpdate=Date.now(),this.updateDetectionRate()}onAlert(e){this.data.alerts.unshift(e),this.data.alerts.length>1e3&&this.data.alerts.pop(),e.severity==="critical"&&this.data.statistics.criticalAlerts++}onSystemMetrics(e){this.data.systemMetrics={...this.data.systemMetrics,...e,lastUpdate:Date.now()}}start(){this.isActive||(this.isActive=!0,this.wsClient.connect(),this.header.querySelector("#start-btn").disabled=!0,this.header.querySelector("#pause-btn").disabled=!1,this.updateConnectionStatus("connecting"))}pause(){this.isActive&&(this.isActive=!1,this.wsClient.disconnect(),this.header.querySelector("#start-btn").disabled=!1,this.header.querySelector("#pause-btn").disabled=!0,this.updateConnectionStatus("paused"))}refresh(){this.data.realTimeData=[],this.data.alerts=[],this.data.statistics={totalAnomalies:0,criticalAlerts:0,avgScore:0,detectionRate:0},this.timeline&&this.timeline.setData([])}showSettings(){console.log("Settings modal would open here")}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.container.requestFullscreen()}updateConnectionStatus(e){this.data.connectionStatus=e;let n=this.header.querySelector("#connection-status"),r=n.querySelector(".status-indicator"),i=n.querySelector(".status-text");r.className=`status-indicator status-${e}`,i.textContent=e.charAt(0).toUpperCase()+e.slice(1)}updateStatistics(){let n=Date.now()-6e4,r=this.data.realTimeData.filter(i=>i.timestamp>n).length;this.data.statistics.detectionRate=r}updateDetectionRate(){this.detectionRateTimer||(this.detectionRateTimer=setInterval(()=>{this.updateStatistics()},1e4))}acknowledgeAlert(e){this.wsClient.acknowledgeAlert(e);let n=document.querySelector(`[data-alert-id="${e}"]`);n&&n.remove()}clearAlerts(){this.wsClient.getUnacknowledgedAlerts().forEach(n=>{this.wsClient.acknowledgeAlert(n.id)})}playNotificationSound(){if("AudioContext"in window){let e=new AudioContext,n=e.createOscillator(),r=e.createGain();n.connect(r),r.connect(e.destination),n.frequency.value=800,n.type="square",r.gain.value=.1,n.start(),n.stop(e.currentTime+.2)}}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification("Critical Anomaly Detected",{body:`Anomaly score: ${e.score.toFixed(3)}`,icon:"/static/icons/alert.png",tag:"anomaly-alert"})}exportData(e="json"){let n={timestamp:new Date().toISOString(),statistics:this.data.statistics,recentData:this.data.realTimeData.slice(-1e3),alerts:this.data.alerts.slice(0,100),systemMetrics:this.data.systemMetrics};switch(e){case"json":return JSON.stringify(n,null,2);case"csv":return this.convertToCSV(n.recentData);default:return n}}convertToCSV(e){if(e.length===0)return"";let n=Object.keys(e[0]),r=e.map(i=>n.map(o=>JSON.stringify(i[o]||"")).join(","));return[n.join(","),...r].join(`
`)}destroy(){this.updateTimers.forEach(e=>clearInterval(e)),this.updateTimers.clear(),this.detectionRateTimer&&clearInterval(this.detectionRateTimer),this.wsClient&&this.wsClient.destroy(),this.timeline&&this.timeline.destroy(),this.dashboardLayout&&this.dashboardLayout.destroy(),this.data=null,this.charts.clear(),this.widgets.clear()}};typeof window<"u"&&(window.dashboard=null);var mw=ri;})();
