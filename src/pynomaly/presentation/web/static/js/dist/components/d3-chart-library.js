(()=>{var w=(d,s)=>()=>(s||d((s={exports:{}}).exports,s),s.exports);var b=w((k,u)=>{var p=class{constructor(){this.charts=new Map,this.themes={light:{background:"#ffffff",text:"#1e293b",grid:"#e2e8f0",primary:"#0ea5e9",secondary:"#22c55e",danger:"#dc2626",warning:"#d97706"},dark:{background:"#0f172a",text:"#f1f5f9",grid:"#334155",primary:"#38bdf8",secondary:"#4ade80",danger:"#f87171",warning:"#fbbf24"}},this.currentTheme="light",this.setupEventListeners()}setupEventListeners(){document.addEventListener("theme-changed",s=>{this.currentTheme=s.detail.theme,this.updateAllChartsTheme()}),window.addEventListener("resize",this.debounce(()=>{this.resizeAllCharts()},250))}debounce(s,e){let t;return function(...a){let o=()=>{clearTimeout(t),s(...a)};clearTimeout(t),t=setTimeout(o,e)}}getTheme(){return this.themes[this.currentTheme]}registerChart(s,e){this.charts.set(s,e)}removeChart(s){let e=this.charts.get(s);e&&e.destroy&&e.destroy(),this.charts.delete(s)}updateAllChartsTheme(){this.charts.forEach(s=>{s.updateTheme&&s.updateTheme(this.getTheme())})}resizeAllCharts(){this.charts.forEach(s=>{s.resize&&s.resize()})}},l=class{constructor(s,e={}){this.container=d3.select(s),this.containerElement=s,this.options={width:800,height:400,margin:{top:20,right:30,bottom:40,left:50},animated:!0,responsive:!0,accessibility:!0,...e},this.data=[],this.svg=null,this.tooltip=null,this.theme=f.getTheme(),this.setupChart(),this.setupAccessibility();let t=this.containerElement.id||`chart-${Date.now()}`;f.registerChart(t,this)}setupChart(){this.container.selectAll("*").remove(),this.updateDimensions(),this.svg=this.container.append("svg").attr("width",this.width).attr("height",this.height).attr("role","img").attr("aria-labelledby",`${this.containerElement.id}-title`).attr("aria-describedby",`${this.containerElement.id}-desc`),this.chartGroup=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.setupTooltip()}setupAccessibility(){if(!this.options.accessibility)return;let s=`${this.containerElement.id}-title`,e=`${this.containerElement.id}-desc`;if(!document.getElementById(s)){let t=document.createElement("h3");t.id=s,t.className="sr-only",t.textContent=this.options.title||"Data Visualization",this.containerElement.insertBefore(t,this.containerElement.firstChild)}if(!document.getElementById(e)){let t=document.createElement("div");t.id=e,t.className="sr-only",t.textContent=this.options.description||"Interactive chart showing data trends and patterns",this.containerElement.appendChild(t)}}setupTooltip(){this.tooltip=d3.select("body").append("div").attr("class","chart-tooltip").style("opacity",0).style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000")}updateDimensions(){if(this.options.responsive){let s=this.containerElement.clientWidth||this.options.width;this.width=Math.max(300,s),this.height=Math.max(200,this.width*.5)}else this.width=this.options.width,this.height=this.options.height;this.innerWidth=this.width-this.options.margin.left-this.options.margin.right,this.innerHeight=this.height-this.options.margin.top-this.options.margin.bottom}showTooltip(s,e){this.tooltip.html(s).style("opacity",1).style("left",e.pageX+10+"px").style("top",e.pageY-10+"px")}hideTooltip(){this.tooltip.style("opacity",0)}updateTheme(s){this.theme=s,this.render()}resize(){this.updateDimensions(),this.svg.attr("width",this.width).attr("height",this.height),this.render()}setData(s){this.data=s,this.render()}render(){throw new Error("render() method must be implemented by subclass")}destroy(){this.tooltip&&this.tooltip.remove(),this.container.selectAll("*").remove()}},x=class extends l{constructor(s,e={}){super(s,{xAccessor:t=>t.timestamp,yAccessor:t=>t.value,anomalyAccessor:t=>t.isAnomaly,confidenceAccessor:t=>t.confidence,showAnomalies:!0,showConfidenceBands:!1,interpolation:d3.curveMonotoneX,...e}),this.xScale=d3.scaleTime(),this.yScale=d3.scaleLinear(),this.line=d3.line().x(t=>this.xScale(this.options.xAccessor(t))).y(t=>this.yScale(this.options.yAccessor(t))).curve(this.options.interpolation)}render(){!this.data||this.data.length===0||(this.chartGroup.selectAll("*").remove(),this.xScale.domain(d3.extent(this.data,this.options.xAccessor)).range([0,this.innerWidth]),this.yScale.domain(d3.extent(this.data,this.options.yAccessor)).nice().range([this.innerHeight,0]),this.addAxes(),this.addMainLine(),this.options.showAnomalies&&this.addAnomalyMarkers(),this.options.showConfidenceBands&&this.addConfidenceBands(),this.addInteraction())}addAxes(){let s=d3.axisBottom(this.xScale).tickFormat(d3.timeFormat("%H:%M"));this.chartGroup.append("g").attr("class","x-axis").attr("transform",`translate(0,${this.innerHeight})`).call(s).selectAll("text").style("fill",this.theme.text);let e=d3.axisLeft(this.yScale);this.chartGroup.append("g").attr("class","y-axis").call(e).selectAll("text").style("fill",this.theme.text),this.chartGroup.selectAll(".domain, .tick line").style("stroke",this.theme.grid)}addMainLine(){let s=this.chartGroup.append("path").datum(this.data).attr("class","main-line").attr("fill","none").attr("stroke",this.theme.primary).attr("stroke-width",2).attr("d",this.line);if(this.options.animated){let e=s.node().getTotalLength();s.attr("stroke-dasharray",e+" "+e).attr("stroke-dashoffset",e).transition().duration(1500).ease(d3.easeLinear).attr("stroke-dashoffset",0)}}addAnomalyMarkers(){let s=this.data.filter(this.options.anomalyAccessor),e=this.chartGroup.selectAll(".anomaly-marker").data(s).enter().append("circle").attr("class","anomaly-marker").attr("cx",t=>this.xScale(this.options.xAccessor(t))).attr("cy",t=>this.yScale(this.options.yAccessor(t))).attr("r",0).attr("fill",this.theme.danger).attr("stroke",this.theme.background).attr("stroke-width",2).attr("opacity",.8).style("cursor","pointer");this.options.animated?e.transition().delay((t,i)=>i*100).duration(300).attr("r",5):e.attr("r",5),e.on("mouseover",(t,i)=>{let a=this.options.confidenceAccessor(i),o=d3.timeFormat("%Y-%m-%d %H:%M:%S")(this.options.xAccessor(i)),n=this.options.yAccessor(i).toFixed(2),r=`
          <strong>Anomaly Detected</strong><br/>
          Time: ${o}<br/>
          Value: ${n}<br/>
          Confidence: ${(a*100).toFixed(1)}%
        `;this.showTooltip(r,t),d3.select(t.target).transition().duration(200).attr("r",7)}).on("mouseout",t=>{this.hideTooltip(),d3.select(t.target).transition().duration(200).attr("r",5)}).on("click",(t,i)=>{this.containerElement.dispatchEvent(new CustomEvent("anomaly-selected",{detail:{data:i,chart:this}}))}),e.attr("aria-label",t=>{let i=d3.timeFormat("%Y-%m-%d %H:%M:%S")(this.options.xAccessor(t)),a=this.options.yAccessor(t).toFixed(2),o=this.options.confidenceAccessor(t);return`Anomaly at ${i}, value ${a}, confidence ${(o*100).toFixed(1)}%`})}addConfidenceBands(){let s=this.data.map(t=>{let i=this.options.confidenceAccessor(t)||.5,a=this.options.yAccessor(t),o=a*(1-i)*.5;return{...t,upper:a+o,lower:a-o}}),e=d3.area().x(t=>this.xScale(this.options.xAccessor(t))).y0(t=>this.yScale(t.lower)).y1(t=>this.yScale(t.upper)).curve(this.options.interpolation);this.chartGroup.append("path").datum(s).attr("class","confidence-band").attr("fill",this.theme.primary).attr("fill-opacity",.2).attr("d",e)}addInteraction(){let s=this.chartGroup.append("rect").attr("class","overlay").attr("width",this.innerWidth).attr("height",this.innerHeight).attr("fill","none").attr("pointer-events","all").style("cursor","crosshair"),e=this.chartGroup.append("line").attr("class","cursor-line").attr("stroke",this.theme.text).attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("opacity",0);s.on("mousemove",t=>{let[i]=d3.pointer(t),a=this.xScale.invert(i),o=d3.bisector(this.options.xAccessor).left,n=o(this.data,a),r=this.data[n-1],h=this.data[n];if(r&&h){let c=a-this.options.xAccessor(r)>this.options.xAccessor(h)-a?h:r;e.attr("x1",this.xScale(this.options.xAccessor(c))).attr("x2",this.xScale(this.options.xAccessor(c))).attr("y1",0).attr("y2",this.innerHeight).attr("opacity",.5);let m=d3.timeFormat("%Y-%m-%d %H:%M:%S")(this.options.xAccessor(c)),A=this.options.yAccessor(c).toFixed(2),S=`
            <strong>Data Point</strong><br/>
            Time: ${m}<br/>
            Value: ${A}
          `;this.showTooltip(S,t)}}).on("mouseleave",()=>{e.attr("opacity",0),this.hideTooltip()})}updateData(s,e=!0){if(this.data=s,e?this.render():this.render(),this.options.accessibility){let t=`Chart updated with ${s.length} data points`;this.announceToScreenReader(t)}}addDataPoint(s,e=1e3){this.data.push(s),this.data.length>e&&(this.data=this.data.slice(-e)),this.render()}announceToScreenReader(s){let e=document.getElementById("chart-announcer");e&&(e.textContent=s)}},y=class extends l{constructor(s,e={}){super(s,{xAccessor:t=>t.x,yAccessor:t=>t.y,colorAccessor:t=>t.anomalyScore,sizeAccessor:t=>t.confidence,anomalyAccessor:t=>t.isAnomaly,showDensity:!1,enableBrushing:!0,enableZoom:!0,...e}),this.xScale=d3.scaleLinear(),this.yScale=d3.scaleLinear(),this.colorScale=d3.scaleSequential(d3.interpolateViridis),this.sizeScale=d3.scaleSqrt().range([3,12]),this.brush=null,this.zoom=null}render(){!this.data||this.data.length===0||(this.chartGroup.selectAll("*").remove(),this.updateScales(),this.addAxes(),this.options.showDensity&&this.addDensityBackground(),this.addScatterPoints(),this.options.enableBrushing&&this.addBrushing(),this.options.enableZoom&&this.addZoom(),this.addLegend())}updateScales(){this.xScale.domain(d3.extent(this.data,this.options.xAccessor)).nice().range([0,this.innerWidth]),this.yScale.domain(d3.extent(this.data,this.options.yAccessor)).nice().range([this.innerHeight,0]),this.colorScale.domain(d3.extent(this.data,this.options.colorAccessor)),this.sizeScale.domain(d3.extent(this.data,this.options.sizeAccessor))}addAxes(){this.chartGroup.append("g").attr("class","x-axis").attr("transform",`translate(0,${this.innerHeight})`).call(d3.axisBottom(this.xScale)).selectAll("text").style("fill",this.theme.text),this.chartGroup.append("g").attr("class","y-axis").call(d3.axisLeft(this.yScale)).selectAll("text").style("fill",this.theme.text),this.chartGroup.append("text").attr("class","x-label").attr("text-anchor","middle").attr("x",this.innerWidth/2).attr("y",this.innerHeight+35).style("fill",this.theme.text).text(this.options.xLabel||"X Value"),this.chartGroup.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-this.innerHeight/2).attr("y",-35).style("fill",this.theme.text).text(this.options.yLabel||"Y Value"),this.chartGroup.selectAll(".domain, .tick line").style("stroke",this.theme.grid)}addScatterPoints(){let s=this.chartGroup.selectAll(".data-point").data(this.data).enter().append("circle").attr("class","data-point").attr("cx",e=>this.xScale(this.options.xAccessor(e))).attr("cy",e=>this.yScale(this.options.yAccessor(e))).attr("r",0).attr("fill",e=>this.options.anomalyAccessor(e)?this.theme.danger:this.colorScale(this.options.colorAccessor(e))).attr("stroke",e=>this.options.anomalyAccessor(e)?this.theme.background:"none").attr("stroke-width",e=>this.options.anomalyAccessor(e)?2:0).attr("opacity",.7).style("cursor","pointer");this.options.animated?s.transition().delay((e,t)=>t*10).duration(500).attr("r",e=>this.sizeScale(this.options.sizeAccessor(e))):s.attr("r",e=>this.sizeScale(this.options.sizeAccessor(e))),s.on("mouseover",(e,t)=>{let i=`
          <strong>${this.options.anomalyAccessor(t)?"Anomaly":"Normal Point"}</strong><br/>
          X: ${this.options.xAccessor(t).toFixed(2)}<br/>
          Y: ${this.options.yAccessor(t).toFixed(2)}<br/>
          Score: ${this.options.colorAccessor(t).toFixed(3)}<br/>
          Confidence: ${(this.options.sizeAccessor(t)*100).toFixed(1)}%
        `;this.showTooltip(i,e),d3.select(e.target).transition().duration(200).attr("r",a=>this.sizeScale(this.options.sizeAccessor(a))*1.5).attr("opacity",1)}).on("mouseout",(e,t)=>{this.hideTooltip(),d3.select(e.target).transition().duration(200).attr("r",i=>this.sizeScale(this.options.sizeAccessor(i))).attr("opacity",.7)}).on("click",(e,t)=>{this.containerElement.dispatchEvent(new CustomEvent("point-selected",{detail:{data:t,chart:this}}))})}addLegend(){let s=this.svg.append("g").attr("class","legend").attr("transform",`translate(${this.width-120}, 20)`),e=s.append("g").attr("class","color-legend");this.svg.append("defs").append("linearGradient").attr("id","color-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",100).selectAll("stop").data(d3.range(0,1.1,.1)).enter().append("stop").attr("offset",o=>`${o*100}%`).attr("stop-color",o=>this.colorScale(d3.quantile(this.data.map(this.options.colorAccessor),o))),e.append("rect").attr("width",20).attr("height",100).style("fill","url(#color-gradient)"),e.append("text").attr("x",25).attr("y",10).style("fill",this.theme.text).style("font-size","12px").text("Anomaly Score");let i=s.append("g").attr("class","size-legend").attr("transform","translate(0, 120)"),a=[.2,.5,.8];i.selectAll(".size-legend-item").data(a).enter().append("g").attr("class","size-legend-item").attr("transform",(o,n)=>`translate(0, ${n*25})`).each(function(o){let n=d3.select(this);n.append("circle").attr("cx",10).attr("cy",0).attr("r",r=>this.sizeScale(r)).attr("fill",this.theme.primary).attr("opacity",.7),n.append("text").attr("x",25).attr("y",4).style("fill",this.theme.text).style("font-size","12px").text(`${(o*100).toFixed(0)}%`)}),i.append("text").attr("x",0).attr("y",-10).style("fill",this.theme.text).style("font-size","12px").text("Confidence")}addBrushing(){this.brush=d3.brush().extent([[0,0],[this.innerWidth,this.innerHeight]]).on("end",s=>{let e=s.selection;if(!e){this.chartGroup.selectAll(".data-point").classed("selected",!1).attr("opacity",.7);return}let[[t,i],[a,o]]=e,n=[];this.chartGroup.selectAll(".data-point").classed("selected",r=>{let h=this.xScale(this.options.xAccessor(r)),c=this.yScale(this.options.yAccessor(r)),m=h>=t&&h<=a&&c>=i&&c<=o;return m&&n.push(r),m}).attr("opacity",r=>{let h=this.xScale(this.options.xAccessor(r)),c=this.yScale(this.options.yAccessor(r));return h>=t&&h<=a&&c>=i&&c<=o?1:.3}),this.containerElement.dispatchEvent(new CustomEvent("points-selected",{detail:{data:n,chart:this}}))}),this.chartGroup.append("g").attr("class","brush").call(this.brush)}addZoom(){this.zoom=d3.zoom().scaleExtent([1,10]).on("zoom",s=>{let{transform:e}=s,t=e.rescaleX(this.xScale),i=e.rescaleY(this.yScale);this.chartGroup.select(".x-axis").call(d3.axisBottom(t)),this.chartGroup.select(".y-axis").call(d3.axisLeft(i)),this.chartGroup.selectAll(".data-point").attr("cx",a=>t(this.options.xAccessor(a))).attr("cy",a=>i(this.options.yAccessor(a)))}),this.svg.call(this.zoom)}},g=class extends l{constructor(s,e={}){super(s,{xAccessor:t=>t.x,yAccessor:t=>t.y,valueAccessor:t=>t.value,gridSize:20,colorScheme:d3.interpolateViridis,showLabels:!0,enableZoom:!1,...e}),this.xScale=d3.scaleBand(),this.yScale=d3.scaleBand(),this.colorScale=d3.scaleSequential()}render(){!this.data||this.data.length===0||(this.chartGroup.selectAll("*").remove(),this.processData(),this.updateScales(),this.addAxes(),this.addHeatmapCells(),this.addColorLegend())}processData(){let s=[...new Set(this.data.map(this.options.xAccessor))].sort(),e=[...new Set(this.data.map(this.options.yAccessor))].sort();this.gridData=[];for(let t of e)for(let i of s){let a=this.data.find(o=>this.options.xAccessor(o)===i&&this.options.yAccessor(o)===t);this.gridData.push({x:i,y:t,value:a?this.options.valueAccessor(a):0,original:a})}this.xValues=s,this.yValues=e}updateScales(){this.xScale.domain(this.xValues).range([0,this.innerWidth]).padding(.1),this.yScale.domain(this.yValues).range([this.innerHeight,0]).padding(.1),this.colorScale.interpolator(this.options.colorScheme).domain(d3.extent(this.gridData,s=>s.value))}addAxes(){this.chartGroup.append("g").attr("class","x-axis").attr("transform",`translate(0,${this.innerHeight})`).call(d3.axisBottom(this.xScale)).selectAll("text").style("fill",this.theme.text).style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),this.chartGroup.append("g").attr("class","y-axis").call(d3.axisLeft(this.yScale)).selectAll("text").style("fill",this.theme.text),this.chartGroup.selectAll(".domain, .tick line").style("stroke",this.theme.grid)}addHeatmapCells(){let s=this.chartGroup.selectAll(".heatmap-cell").data(this.gridData).enter().append("rect").attr("class","heatmap-cell").attr("x",e=>this.xScale(e.x)).attr("y",e=>this.yScale(e.y)).attr("width",this.xScale.bandwidth()).attr("height",this.yScale.bandwidth()).attr("fill",e=>this.colorScale(e.value)).attr("stroke",this.theme.background).attr("stroke-width",1).attr("opacity",0).style("cursor","pointer");this.options.animated?s.transition().delay((e,t)=>t*20).duration(500).attr("opacity",1):s.attr("opacity",1),s.on("mouseover",(e,t)=>{let i=`
          <strong>Cell (${t.x}, ${t.y})</strong><br/>
          Value: ${t.value.toFixed(3)}
        `;this.showTooltip(i,e),d3.select(e.target).attr("stroke-width",3).attr("stroke",this.theme.text)}).on("mouseout",e=>{this.hideTooltip(),d3.select(e.target).attr("stroke-width",1).attr("stroke",this.theme.background)}).on("click",(e,t)=>{this.containerElement.dispatchEvent(new CustomEvent("cell-selected",{detail:{data:t,chart:this}}))}),this.options.showLabels&&this.chartGroup.selectAll(".cell-label").data(this.gridData.filter(e=>e.value>0)).enter().append("text").attr("class","cell-label").attr("x",e=>this.xScale(e.x)+this.xScale.bandwidth()/2).attr("y",e=>this.yScale(e.y)+this.yScale.bandwidth()/2).attr("text-anchor","middle").attr("dy",".35em").style("fill",e=>e.value>this.colorScale.domain()[1]*.6?"white":"black").style("font-size","10px").style("pointer-events","none").text(e=>e.value.toFixed(2))}addColorLegend(){let s=this.svg.append("g").attr("class","color-legend").attr("transform",`translate(${this.width-100}, 20)`);this.svg.append("defs").append("linearGradient").attr("id","heatmap-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",100).attr("x2",0).attr("y2",0).selectAll("stop").data(d3.range(0,1.1,.1)).enter().append("stop").attr("offset",a=>`${a*100}%`).attr("stop-color",a=>this.colorScale(d3.quantile(this.colorScale.domain(),a))),s.append("rect").attr("width",20).attr("height",100).style("fill","url(#heatmap-gradient)").style("stroke",this.theme.grid);let t=d3.scaleLinear().domain(this.colorScale.domain()).range([100,0]),i=d3.axisRight(t).tickSize(6).tickFormat(d3.format(".2f"));s.append("g").attr("class","legend-axis").attr("transform","translate(20, 0)").call(i).selectAll("text").style("fill",this.theme.text).style("font-size","10px"),s.append("text").attr("x",0).attr("y",-5).style("fill",this.theme.text).style("font-size","12px").text("Value")}},f=new p;typeof u<"u"&&u.exports?u.exports={D3ChartLibrary:p,BaseChart:l,TimeSeriesChart:x,ScatterPlotChart:y,HeatmapChart:g}:(window.D3ChartLibrary=p,window.BaseChart=l,window.TimeSeriesChart=x,window.ScatterPlotChart=y,window.HeatmapChart=g,window.chartLibrary=f)});b();})();
