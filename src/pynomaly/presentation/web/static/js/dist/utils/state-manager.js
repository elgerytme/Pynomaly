(()=>{var h=class{constructor(t={},e={}){this.state={...t},this.listeners=new Set,this.middleware=[],this.history=[],this.historyIndex=-1,this.options={maxHistorySize:50,enableTimeTravel:!0,enableLogging:!1,persistState:!1,persistKey:"pynomaly-state",...e},this.actionQueue=[],this.isDispatching=!1,this.init()}init(){this.options.persistState&&this.loadPersistedState(),this.options.enableLogging&&this.use(this.createLoggingMiddleware()),this.options.enableTimeTravel&&this.saveToHistory({type:"@@INIT",payload:null})}dispatch(t){if(typeof t!="object"||t===null)throw new Error("Action must be a plain object");if(typeof t.type!="string")throw new Error("Action must have a type property");if(typeof t=="function")return t(this.dispatch.bind(this),this.getState.bind(this));if(this.isDispatching){this.actionQueue.push(t);return}this.isDispatching=!0;try{let e=this.middleware.slice(),s=this.dispatchAction.bind(this);for(let r=e.length-1;r>=0;r--){let n=e[r];s=n(this)(s)}let i=s(t);return this.processActionQueue(),i}finally{this.isDispatching=!1}}dispatchAction(t){let e=this.state;return this.state=this.reduce(this.state,t),this.options.enableTimeTravel&&this.saveToHistory(t),this.options.persistState&&this.persistState(),this.notifyListeners(e,this.state,t),t}processActionQueue(){for(;this.actionQueue.length>0;){let t=this.actionQueue.shift();this.dispatchAction(t)}}getState(){return{...this.state}}subscribe(t){if(typeof t!="function")throw new Error("Listener must be a function");return this.listeners.add(t),()=>{this.listeners.delete(t)}}use(t){if(typeof t!="function")throw new Error("Middleware must be a function");return this.middleware.push(t),this}reduce(t,e){switch(e.type){case"@@STATE/RESET":return e.payload||{};case"@@STATE/MERGE":return{...t,...e.payload};case"@@STATE/SET_PROPERTY":return this.setNestedProperty(t,e.payload.path,e.payload.value);case"@@STATE/DELETE_PROPERTY":return this.deleteNestedProperty(t,e.payload.path);default:return this.handleCustomAction(t,e)}}handleCustomAction(t,e){return t}setNestedProperty(t,e,s){let i=Array.isArray(e)?e:e.split("."),r={...t},n=r;for(let o=0;o<i.length-1;o++){let l=i[o];n[l]={...n[l]},n=n[l]}return n[i[i.length-1]]=s,r}deleteNestedProperty(t,e){let s=Array.isArray(e)?e:e.split("."),i={...t},r=i;for(let n=0;n<s.length-1;n++){let o=s[n];r[o]={...r[o]},r=r[o]}return delete r[s[s.length-1]],i}notifyListeners(t,e,s){this.listeners.forEach(i=>{try{i(e,t,s)}catch(r){console.error("Error in state listener:",r)}})}saveToHistory(t){this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push({state:{...this.state},action:{...t},timestamp:Date.now()}),this.history.length>this.options.maxHistorySize?this.history.shift():this.historyIndex++}undo(){if(!this.options.enableTimeTravel||this.historyIndex<=0)return!1;this.historyIndex--;let t=this.history[this.historyIndex],e=this.state;return this.state={...t.state},this.notifyListeners(e,this.state,{type:"@@HISTORY/UNDO",payload:{historyIndex:this.historyIndex}}),!0}redo(){if(!this.options.enableTimeTravel||this.historyIndex>=this.history.length-1)return!1;this.historyIndex++;let t=this.history[this.historyIndex],e=this.state;return this.state={...t.state},this.notifyListeners(e,this.state,{type:"@@HISTORY/REDO",payload:{historyIndex:this.historyIndex}}),!0}jumpToHistory(t){if(!this.options.enableTimeTravel||t<0||t>=this.history.length)return!1;let e=this.history[t],s=this.state;return this.historyIndex=t,this.state={...e.state},this.notifyListeners(s,this.state,{type:"@@HISTORY/JUMP",payload:{historyIndex:t}}),!0}getHistory(){return this.history.map((t,e)=>({...t,index:e,isCurrent:e===this.historyIndex}))}persistState(){try{localStorage.setItem(this.options.persistKey,JSON.stringify(this.state))}catch(t){console.warn("Failed to persist state:",t)}}loadPersistedState(){try{let t=localStorage.getItem(this.options.persistKey);t&&(this.state={...this.state,...JSON.parse(t)})}catch(t){console.warn("Failed to load persisted state:",t)}}clearPersistedState(){try{localStorage.removeItem(this.options.persistKey)}catch(t){console.warn("Failed to clear persisted state:",t)}}createLoggingMiddleware(){return t=>e=>s=>{let i=t.getState();console.group(`\u{1F3AF} Action: ${s.type}`),console.log("\u{1F4E4} Dispatching:",s),console.log("\u{1F4CB} Previous state:",i);let r=e(s);return console.log("\u{1F4CB} Next state:",t.getState()),console.groupEnd(),r}}createAsyncMiddleware(){return t=>e=>s=>typeof s=="function"?s(t.dispatch,t.getState):s&&typeof s.then=="function"?s.then(t.dispatch):e(s)}createValidationMiddleware(t={}){return e=>s=>i=>{let r=t[i.type];return r&&!r(i,e.getState())?(console.warn(`Validation failed for action: ${i.type}`),i):s(i)}}createActions(){return{reset:(t={})=>({type:"@@STATE/RESET",payload:t}),merge:t=>({type:"@@STATE/MERGE",payload:t}),set:(t,e)=>({type:"@@STATE/SET_PROPERTY",payload:{path:t,value:e}}),delete:t=>({type:"@@STATE/DELETE_PROPERTY",payload:{path:t}})}}select(t){return typeof t=="string"?this.getNestedProperty(this.state,t):typeof t=="function"?t(this.state):this.state}getNestedProperty(t,e){return(Array.isArray(e)?e:e.split(".")).reduce((i,r)=>i&&i[r],t)}batch(t){let e=this.state,s={type:"@@BATCH",payload:t},i=this.notifyListeners;this.notifyListeners=()=>{};try{t.forEach(r=>this.dispatch(r)),s.payload={actions:t,count:t.length}}finally{this.notifyListeners=i}this.notifyListeners(e,this.state,s)}connectDevTools(){typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__&&(this.devTools=window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:"Pynomaly State Manager"}),this.devTools.init(this.state),this.subscribe((t,e,s)=>{this.devTools.send(s,t)}),this.devTools.subscribe(t=>{if(t.type==="DISPATCH")switch(t.payload.type){case"JUMP_TO_STATE":case"JUMP_TO_ACTION":this.state=JSON.parse(t.state),this.notifyListeners({},this.state,{type:"@@DEVTOOLS"});break}}))}destroy(){this.listeners.clear(),this.middleware=[],this.history=[],this.devTools&&this.devTools.disconnect()}},d=class{constructor(t){this.stateManager=t,this.components=new Map}useState(t,e=s=>s){this.components.has(t)||this.components.set(t,{selectors:new Set,unsubscribe:null});let s=this.components.get(t);return s.selectors.add(e),s.unsubscribe||(s.unsubscribe=this.stateManager.subscribe((i,r,n)=>{let o=Array.from(s.selectors).some(l=>{let p=l(i),u=l(r);return!this.shallowEqual(p,u)});o&&typeof t.forceUpdate=="function"?t.forceUpdate():o&&typeof t.render=="function"&&t.render()})),[this.stateManager.select(e),this.stateManager.dispatch.bind(this.stateManager)]}useDispatch(){return this.stateManager.dispatch.bind(this.stateManager)}useSelector(t){return this.stateManager.select(t)}useActions(t){let e=this.stateManager.dispatch.bind(this.stateManager);if(typeof t=="function")return(...s)=>e(t(...s));if(typeof t=="object"){let s={};return Object.keys(t).forEach(i=>{s[i]=(...r)=>e(t[i](...r))}),s}return e}cleanup(t){let e=this.components.get(t);e&&e.unsubscribe&&(e.unsubscribe(),this.components.delete(t))}shallowEqual(t,e){if(t===e)return!0;if(typeof t!="object"||typeof e!="object"||t===null||e===null)return!1;let s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(let r of s)if(t[r]!==e[r])return!1;return!0}},y=class extends h{constructor(t={}){let e={datasets:[],models:[],results:[],currentDataset:null,currentModel:null,isLoading:!1,error:null,ui:{activeTab:"overview",sidebarOpen:!0,notifications:[],theme:"light"},realTime:{connected:!1,streamingData:[],alerts:[]},...t};super(e,{enableTimeTravel:!0,enableLogging:!1,persistState:!0,persistKey:"pynomaly-app-state"}),this.use(this.createAsyncMiddleware())}handleCustomAction(t,e){switch(e.type){case"DATASETS/LOAD_REQUEST":return{...t,isLoading:!0,error:null};case"DATASETS/LOAD_SUCCESS":return{...t,datasets:e.payload,isLoading:!1,error:null};case"DATASETS/LOAD_FAILURE":return{...t,datasets:[],isLoading:!1,error:e.payload};case"DATASETS/SELECT":return{...t,currentDataset:e.payload};case"MODELS/LOAD_SUCCESS":return{...t,models:e.payload};case"MODELS/SELECT":return{...t,currentModel:e.payload};case"RESULTS/ADD":return{...t,results:[...t.results,e.payload]};case"RESULTS/UPDATE":return{...t,results:t.results.map(s=>s.id===e.payload.id?{...s,...e.payload}:s)};case"UI/SET_ACTIVE_TAB":return{...t,ui:{...t.ui,activeTab:e.payload}};case"UI/TOGGLE_SIDEBAR":return{...t,ui:{...t.ui,sidebarOpen:!t.ui.sidebarOpen}};case"UI/ADD_NOTIFICATION":return{...t,ui:{...t.ui,notifications:[...t.ui.notifications,e.payload]}};case"UI/REMOVE_NOTIFICATION":return{...t,ui:{...t.ui,notifications:t.ui.notifications.filter(s=>s.id!==e.payload)}};case"REALTIME/CONNECT":return{...t,realTime:{...t.realTime,connected:!0}};case"REALTIME/DISCONNECT":return{...t,realTime:{...t.realTime,connected:!1}};case"REALTIME/ADD_DATA":return{...t,realTime:{...t.realTime,streamingData:[...t.realTime.streamingData,e.payload]}};case"REALTIME/ADD_ALERT":return{...t,realTime:{...t.realTime,alerts:[...t.realTime.alerts,e.payload]}};default:return t}}},c={loadDatasets:()=>async(a,t)=>{a({type:"DATASETS/LOAD_REQUEST"});try{let s=await(await fetch("/api/datasets")).json();a({type:"DATASETS/LOAD_SUCCESS",payload:s})}catch(e){a({type:"DATASETS/LOAD_FAILURE",payload:e.message})}},selectDataset:a=>({type:"DATASETS/SELECT",payload:a}),loadModels:()=>async a=>{try{let e=await(await fetch("/api/models")).json();a({type:"MODELS/LOAD_SUCCESS",payload:e})}catch(t){console.error("Failed to load models:",t)}},selectModel:a=>({type:"MODELS/SELECT",payload:a}),addResult:a=>({type:"RESULTS/ADD",payload:{...a,id:Date.now(),timestamp:new Date().toISOString()}}),updateResult:(a,t)=>({type:"RESULTS/UPDATE",payload:{id:a,...t}}),setActiveTab:a=>({type:"UI/SET_ACTIVE_TAB",payload:a}),toggleSidebar:()=>({type:"UI/TOGGLE_SIDEBAR"}),addNotification:(a,t="info",e=5e3)=>({type:"UI/ADD_NOTIFICATION",payload:{id:Date.now(),message:a,type:t,timestamp:Date.now(),duration:e}}),removeNotification:a=>({type:"UI/REMOVE_NOTIFICATION",payload:a}),connectRealTime:()=>({type:"REALTIME/CONNECT"}),disconnectRealTime:()=>({type:"REALTIME/DISCONNECT"}),addStreamingData:a=>({type:"REALTIME/ADD_DATA",payload:a}),addAlert:a=>({type:"REALTIME/ADD_ALERT",payload:{...a,id:Date.now(),timestamp:new Date().toISOString()}})},T=h;})();
