{% extends "base.html" %} {% block title %}Experiments{% endblock %} {% block
content %}
<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Experiments</h1>
      <p class="text-gray-600 mt-1">
        Track and manage your anomaly detection experiments
      </p>
    </div>
    <div class="flex space-x-3">
      <button onclick="showCreateModal()" class="btn btn-primary">
        ðŸ§ª New Experiment
      </button>
    </div>
  </div>

  <!-- Experiments Grid -->
  {% if experiments %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for experiment in experiments %}
    <div class="card hover:shadow-md transition-shadow">
      <div class="card-header">
        <h3 class="card-title truncate">{{ experiment.name }}</h3>
        <div class="text-xs text-gray-500">
          {{ experiment.created_at.strftime('%Y-%m-%d') }}
        </div>
      </div>
      <div class="card-content">
        {% if experiment.description %}
        <p class="text-gray-600 text-sm mb-3 line-clamp-2">
          {{ experiment.description }}
        </p>
        {% endif %}

        <div class="flex justify-between items-center mb-4">
          <div class="text-center">
            <div class="text-lg font-semibold text-blue-600">
              {{ experiment.run_count }}
            </div>
            <div class="text-xs text-gray-500">Runs</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-semibold text-green-600">
              {% if experiment.run_count > 0 %}Active{% else %}New{% endif %}
            </div>
            <div class="text-xs text-gray-500">Status</div>
          </div>
        </div>

        <div class="flex space-x-2">
          <a
            href="/web/experiments/{{ experiment.id }}"
            class="btn btn-outline btn-sm flex-1"
          >
            View
          </a>
          <button
            onclick="runExperiment('{{ experiment.id }}')"
            class="btn btn-primary btn-sm flex-1"
          >
            Run
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <!-- Empty State -->
  <div class="text-center py-12">
    <div class="text-6xl mb-4">ðŸ§ª</div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No Experiments Yet</h3>
    <p class="text-gray-600 mb-6">
      Create your first experiment to start tracking your anomaly detection
      workflows.
    </p>
    <button onclick="showCreateModal()" class="btn btn-primary">
      Create First Experiment
    </button>
  </div>
  {% endif %}

  <!-- Recent Activity -->
  {% if experiments %}
  <div class="mt-12">
    <h2 class="text-xl font-semibold text-gray-900 mb-6">Recent Activity</h2>
    <div class="card">
      <div class="card-content">
        <div class="space-y-4">
          {% for experiment in experiments[:5] %}
          <div
            class="flex items-center justify-between border-b border-gray-100 pb-3 last:border-b-0"
          >
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
              <div>
                <div class="font-medium">{{ experiment.name }}</div>
                <div class="text-sm text-gray-500">
                  Created {{ experiment.created_at.strftime('%Y-%m-%d %H:%M') }}
                </div>
              </div>
            </div>
            <div class="text-sm text-gray-600">
              {{ experiment.run_count }} runs
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Create Experiment Modal -->
  <div id="createModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Experiment</h3>
        <button onclick="hideCreateModal()" class="modal-close">&times;</button>
      </div>

      <form
        hx-post="/api/experiments"
        hx-target="body"
        hx-on::after-request="handleExperimentCreated()"
        enctype="application/json"
      >
        <div class="modal-body space-y-4">
          <div>
            <label
              for="exp-name"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Experiment Name
            </label>
            <input
              type="text"
              id="exp-name"
              name="name"
              required
              class="input w-full"
              placeholder="Enter experiment name"
            />
          </div>

          <div>
            <label
              for="exp-description"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Description
            </label>
            <textarea
              id="exp-description"
              name="description"
              rows="3"
              class="input w-full"
              placeholder="Describe your experiment..."
            ></textarea>
          </div>

          <div>
            <label
              for="exp-tags"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Tags (Optional)
            </label>
            <input
              type="text"
              id="exp-tags"
              name="tags"
              class="input w-full"
              placeholder="Comma-separated tags"
            />
            <p class="text-xs text-gray-500 mt-1">
              Example: fraud-detection, ensemble, production
            </p>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="flex items-center">
                <input type="checkbox" name="auto_save" checked class="mr-2" />
                <span class="text-sm text-gray-700">Auto-save results</span>
              </label>
            </div>
            <div>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  name="track_metrics"
                  checked
                  class="mr-2"
                />
                <span class="text-sm text-gray-700"
                  >Track performance metrics</span
                >
              </label>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            onclick="hideCreateModal()"
            class="btn btn-outline"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Create Experiment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function showCreateModal() {
    document.getElementById("createModal").style.display = "block";
  }

  function hideCreateModal() {
    document.getElementById("createModal").style.display = "none";
    document.querySelector("#createModal form").reset();
  }

  function runExperiment(experimentId) {
    // In a real implementation, this would trigger an experiment run
    alert(`Starting experiment run for ${experimentId}`);
  }

  function handleExperimentCreated() {
    hideCreateModal();
    // Refresh the page to show the new experiment
    window.location.reload();
  }

  // Close modal when clicking outside
  window.onclick = function (event) {
    const modal = document.getElementById("createModal");
    if (event.target === modal) {
      hideCreateModal();
    }
  };
</script>
{% endblock %}
