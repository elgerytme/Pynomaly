apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: pynomaly-production

resources:
- ../../base

images:
- name: pynomaly/detection
  newTag: v0.2.0-production

replicas:
- name: pynomaly-detection
  count: 5

patchesStrategicMerge:
- deployment-patch.yaml
- service-patch.yaml
- configmap-patch.yaml
- hpa-patch.yaml

patchesJson6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: pynomaly-detection
  path: deployment-resources-patch.yaml

commonLabels:
  environment: production
  tier: production

commonAnnotations:
  environment: production
  deployed-by: kubernetes
  monitoring: enabled

configMapGenerator:
- name: pynomaly-config-production
  literals:
  - PYNOMALY_ENV=production
  - PYNOMALY_LOG_LEVEL=WARNING
  - PYNOMALY_WORKERS=8
  - PYNOMALY_MEMORY_LIMIT_GB=8
  - PYNOMALY_BATCH_SIZE=2000
  - PYNOMALY_PARALLEL_JOBS=8
  - PYNOMALY_ENABLE_METRICS=true
  - PYNOMALY_ENABLE_CACHE=true

secretGenerator:
- name: pynomaly-secrets-production
  literals:
  - PYNOMALY_DB_HOST=prod-postgres.amazonaws.com
  - PYNOMALY_REDIS_HOST=prod-redis.amazonaws.com
  - PYNOMALY_S3_BUCKET=pynomaly-production-data
  - PYNOMALY_S3_REGION=us-east-1