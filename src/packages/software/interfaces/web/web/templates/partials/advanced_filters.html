<!-- Advanced Filtering Component -->
<div
  class="bg-white shadow rounded-lg p-4 mb-6"
  x-data="{ filtersOpen: false }"
>
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-medium text-gray-900">üîç Advanced Filters</h3>
    <button
      @click="filtersOpen = !filtersOpen"
      class="text-primary hover:text-blue-700 flex items-center"
    >
      <span x-text="filtersOpen ? 'Hide Filters' : 'Show Filters'"></span>
      <svg
        class="ml-1 h-4 w-4 transform transition-transform"
        :class="filtersOpen ? 'rotate-180' : ''"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 9l-7 7-7-7"
        />
      </svg>
    </button>
  </div>

  <div x-show="filtersOpen" x-transition class="space-y-4">
    <!-- Filter Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
      <!-- Status Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Status</label
        >
        <select
          name="status_filter"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        >
          <option value="">All Status</option>
          <option value="trained">Trained</option>
          <option value="pending">Pending</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      <!-- Algorithm Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Algorithm</label
        >
        <select
          name="algorithm_filter"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        >
          <option value="">All Algorithms</option>
          <option value="IsolationForest">Isolation Forest</option>
          <option value="LOF">Local Outlier Factor</option>
          <option value="OneClassSVM">One-Class SVM</option>
          <option value="EllipticEnvelope">Elliptic Envelope</option>
          <option value="AutoEncoder">AutoEncoder</option>
        </select>
      </div>

      <!-- Date Range Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Created After</label
        >
        <input
          type="date"
          name="date_from"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Created Before</label
        >
        <input
          type="date"
          name="date_to"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        />
      </div>
    </div>

    <!-- Search and Performance Filters -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Search Box -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Search</label
        >
        <input
          type="text"
          name="search"
          placeholder="Search by name, description..."
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        />
      </div>

      <!-- Performance Range -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Min Performance</label
        >
        <input
          type="number"
          name="min_performance"
          placeholder="0.0"
          min="0"
          max="1"
          step="0.01"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        />
      </div>

      <!-- Sort By -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Sort By</label
        >
        <select
          name="sort_by"
          class="w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"
        >
          <option value="created_desc">Created (Newest First)</option>
          <option value="created_asc">Created (Oldest First)</option>
          <option value="name_asc">Name (A-Z)</option>
          <option value="name_desc">Name (Z-A)</option>
          <option value="performance_desc">Performance (Best First)</option>
          <option value="performance_asc">Performance (Worst First)</option>
        </select>
      </div>
    </div>

    <!-- Filter Actions -->
    <div class="flex justify-between items-center pt-4 border-t">
      <div class="text-sm text-gray-500">
        <span id="filter-count">Showing all items</span>
      </div>
      <div class="space-x-2">
        <button
          onclick="clearFilters()"
          class="px-3 py-2 text-sm border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
        >
          Clear Filters
        </button>
        <button
          onclick="applyFilters()"
          class="px-3 py-2 text-sm bg-primary text-white rounded-md hover:bg-blue-700"
        >
          Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function clearFilters() {
    // Clear all filter inputs
    document
      .querySelectorAll(
        '[name$="_filter"], [name="search"], [name="date_from"], [name="date_to"], [name="min_performance"], [name="sort_by"]',
      )
      .forEach((input) => {
        if (input.type === "select-one") {
          input.selectedIndex = 0;
        } else {
          input.value = "";
        }
      });

    // Trigger filter application
    applyFilters();
  }

  function applyFilters() {
    // Collect filter values
    const filters = {
      status: document.querySelector('[name="status_filter"]').value,
      algorithm: document.querySelector('[name="algorithm_filter"]').value,
      search: document.querySelector('[name="search"]').value,
      date_from: document.querySelector('[name="date_from"]').value,
      date_to: document.querySelector('[name="date_to"]').value,
      min_performance: document.querySelector('[name="min_performance"]').value,
      sort_by: document.querySelector('[name="sort_by"]').value,
    };

    // Apply filters via HTMX
    const targetElement = document.querySelector("[data-filter-target]");
    if (targetElement) {
      const endpoint = targetElement.getAttribute("data-filter-endpoint");
      const params = new URLSearchParams();

      Object.entries(filters).forEach(([key, value]) => {
        if (value) params.append(key, value);
      });

      htmx.get(endpoint + "?" + params.toString(), {
        target: targetElement,
        swap: "innerHTML",
      });
    }
  }

  // Auto-apply filters on input change
  document.addEventListener("DOMContentLoaded", function () {
    const filterInputs = document.querySelectorAll(
      '[name$="_filter"], [name="search"], [name="date_from"], [name="date_to"], [name="min_performance"], [name="sort_by"]',
    );
    filterInputs.forEach((input) => {
      input.addEventListener("change", function () {
        // Debounce for text inputs
        if (this.type === "text") {
          clearTimeout(this.filterTimeout);
          this.filterTimeout = setTimeout(applyFilters, 500);
        } else {
          applyFilters();
        }
      });
    });
  });
</script>
